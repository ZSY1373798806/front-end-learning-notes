## JavaScript æ ¸å¿ƒçŸ¥è¯†æ•´ç†

------

### 1ï¸âƒ£ æ•°æ®ç±»å‹

#### åŸºæœ¬æ•°æ®ç±»å‹

| ç±»å‹      | æè¿°                   | å†…å­˜ä½ç½®                               |
| --------- | ---------------------- | -------------------------------------- |
| Number    | æ•°å­—ï¼ŒåŒ…æ‹¬æ•´æ•°å’Œæµ®ç‚¹æ•° | æ ˆï¼ˆå°æ•´æ•°ï¼‰ã€å †ï¼ˆå¤§æ•´æ•°/æµ®ç‚¹æ•°ï¼‰      |
| String    | å­—ç¬¦ä¸²                 | å †ï¼Œæ ˆå­˜å¼•ç”¨ï¼Œå­—ç¬¦ä¸²ç›¸åŒæ—¶å¼•ç”¨åœ°å€ç›¸åŒ |
| Boolean   | å¸ƒå°”å€¼                 | æ ˆ                                     |
| Symbol    | å”¯ä¸€æ ‡è¯†ç¬¦             | æ ˆ                                     |
| null      | ç©º                     | æ ˆ                                     |
| undefined | æœªå®šä¹‰                 | æ ˆ                                     |

#### å¼•ç”¨æ•°æ®ç±»å‹

| ç±»å‹     | æè¿°       |
| -------- | ---------- |
| Object   | å¯¹è±¡       |
| Array    | æ•°ç»„       |
| Function | å‡½æ•°       |
| Date     | æ—¥æœŸ       |
| RegExp   | æ­£åˆ™è¡¨è¾¾å¼ |

#### æ•°æ®ç±»å‹åˆ¤æ–­æ–¹æ³•

| æ–¹æ³•                               | ä¼˜ç‚¹                                     | ç¼ºç‚¹                                        |
| ---------------------------------- | ---------------------------------------- | ------------------------------------------- |
| `typeof`                           | å¿«é€ŸåŒºåˆ†åŸºæœ¬ç±»å‹                         | å¯¹ `null` è¿”å› `object`ï¼ŒArray/å¯¹è±¡æ— æ³•åŒºåˆ† |
| `instanceof`                       | åŒºåˆ† Array/Object/Functionï¼Œè‡ªå®šä¹‰ç±»å®ä¾‹ | å¯¹åŸºæœ¬ç±»å‹ä¸é€‚ç”¨                            |
| `Object.prototype.toString.call()` | ç²¾å‡†åˆ¤æ–­å„ç§ç±»å‹                         | å†™æ³•è¾ƒé•¿                                    |

### 2ï¸âƒ£ æ ˆ & å †

| å±æ€§     | æ ˆ                 | å †                           |
| -------- | ------------------ | ---------------------------- |
| ç‰¹æ€§     | å…ˆè¿›åå‡ºï¼ˆLIFOï¼‰   | åŠ¨æ€åˆ†é…ï¼Œå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰   |
| å†…å­˜ç®¡ç† | è‡ªåŠ¨åˆ†é…é‡Šæ”¾       | æ‰‹åŠ¨åˆ†é…ï¼Œç¨‹åºç»“æŸç”± OS å›æ”¶ |
| ç”¨é€”     | å‡½æ•°å‚æ•°ã€å±€éƒ¨å˜é‡ | å¯¹è±¡ã€å¼•ç”¨ç±»å‹               |
| å†…å­˜æ–¹å‘ | é«˜ â†’ ä½            | ä½ â†’ é«˜                      |

### 3ï¸âƒ£ é—­åŒ… (Closure)

#### å®šä¹‰

> é—­åŒ…æ˜¯æŒ‡æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°ã€‚

#### æ¡ä»¶

- å‡½æ•°åµŒå¥—
- å†…éƒ¨å‡½æ•°å¼•ç”¨å¤–éƒ¨å‡½æ•°å±€éƒ¨å˜é‡

#### ä¼˜ç¼ºç‚¹

- **ä¼˜ç‚¹**ï¼šå°è£…ç§æœ‰å˜é‡ã€å®ç°æ¨¡å—åŒ–ã€å»¶é•¿å±€éƒ¨å˜é‡ç”Ÿå‘½å‘¨æœŸ
- **ç¼ºç‚¹**ï¼šå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼

#### åœºæ™¯

- é˜²æŠ–ã€è®¡æ•°å™¨ã€æ¨¡å—åŒ–è®¾è®¡

### 4ï¸âƒ£ åŸå‹ & åŸå‹é“¾
![](https://i-coder.oss-cn-beijing.aliyuncs.com/files/20220213162310.png)

æŸ¥æ‰¾æµç¨‹å›¾

```
myDog å¯¹è±¡
    â†“ __proto__
Dog.prototype
    â†“ __proto__  
Animal.prototype
    â†“ __proto__
Object.prototype
    â†“ __proto__
    null
```

- ğŸ¯ æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ

  - ä»€ä¹ˆæ˜¯åŸå‹ï¼Ÿ

     **åŸå‹ï¼ˆPrototypeï¼‰** æ˜¯jsä¸­å®ç°ç»§æ‰¿å’Œå±æ€§å…±äº«çš„æœºåˆ¶ã€‚æ¯ä¸ªjså¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨é“¾æ¥æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯å®ƒçš„"åŸå‹"ã€‚

  - ä»€ä¹ˆæ˜¯åŸå‹é“¾ï¼Ÿ

â€‹				**åŸå‹é“¾ï¼ˆPrototype Chainï¼‰** æ˜¯jsä¸­å¯¹è±¡å±æ€§æŸ¥æ‰¾çš„æœºåˆ¶ã€‚å½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¦‚æœå¯¹è±¡æœ¬èº«æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±ä¼šæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å±æ€§æˆ–åˆ°è¾¾é“¾çš„é¡¶ç«¯ï¼ˆnullï¼‰ã€‚

- #### å…³ç³»

  - æ¯ä¸ªå‡½æ•°å¯¹è±¡éƒ½æœ‰ `prototype`ï¼ˆæ˜¾å¼åŸå‹ï¼‰

  - æ¯ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ `__proto__`ï¼ˆéšå¼åŸå‹ï¼‰

  - `å®ä¾‹.__proto__` æŒ‡å‘ `æ„é€ å‡½æ•°.prototype`

    ```js
    Person.prototype.constructor = Person
    per._proto_ = Person.prototype
    
    Person.prototype._proto_=Object.prototype
    ```

    | æ¦‚å¿µ          | è¯´æ˜                             | æŒ‡å‘å…³ç³»                                  |
    | ------------- | -------------------------------- | ----------------------------------------- |
    | `__proto__`   | å®ä¾‹å¯¹è±¡çš„å†…éƒ¨å±æ€§ï¼ŒæŒ‡å‘å…¶åŸå‹   | `person.__proto__` â†’ `Person.prototype`   |
    | `prototype`   | å‡½æ•°çš„å±æ€§ï¼ŒåŒ…å«å…±äº«çš„å±æ€§å’Œæ–¹æ³• | `Person.prototype` â†’ åŸå‹å¯¹è±¡             |
    | `constructor` | åŸå‹å¯¹è±¡çš„å±æ€§ï¼ŒæŒ‡å‘æ„é€ å‡½æ•°     | `Person.prototype.constructor` â†’ `Person` |

- #### ä½œç”¨

    - å®ç°ç»§æ‰¿
    - æ‰€æœ‰å®ä¾‹å…±äº«åŸå‹æ–¹æ³•å’Œå±æ€§

    #### åŸå‹é“¾çš„æŸ¥æ‰¾è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ

    1. åœ¨å¯¹è±¡è‡ªèº«æŸ¥æ‰¾å±æ€§
    2. å¦‚æœæ²¡æ‰¾åˆ°ï¼ŒæŸ¥æ‰¾`obj.__proto__`ï¼ˆå³æ„é€ å‡½æ•°çš„prototypeï¼‰
    3. ç»§ç»­æ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾
    4. ç›´åˆ°æ‰¾åˆ°å±æ€§æˆ–åˆ°è¾¾`Object.prototype.__proto__`ï¼ˆnullï¼‰
    5. å¦‚æœæ•´æ¡é“¾éƒ½æ²¡æ‰¾åˆ°ï¼Œè¿”å›undefined


### 5ï¸âƒ£ ç»§æ‰¿æ–¹å¼

#### åŸå‹é“¾ç»§æ‰¿

```js
Child.prototype = new Parent();
```

#### æ„é€ å‡½æ•°ç»§æ‰¿

```js
function Child() {
  Parent.call(this);
}
```

#### ç»„åˆç»§æ‰¿

```js
function Child(arg1, arg2) {
  Parent.call(this, arg1);
  this.arg2 = arg2;
}
Child.prototype = new Parent();
Child.prototype.constructor = Child;
```

#### å®Œæ•´ç»§æ‰¿ï¼ˆå…¼å®¹ ES5/ES6ï¼‰

```js
function inherit(Child, Parent) {
  Child.prototype = Object.create(Parent.prototype);
  Child.prototype.constructor = Child;
  Child.super = Parent;
  if (Object.setPrototypeOf) {
    Object.setPrototypeOf(Child, Parent);
  } else if (Child.__proto__) {
    Child.__proto__ = Parent;
  } else {
    for (let k in Parent) {
      if (Parent.hasOwnProperty(k) && !(k in Child)) Child[k] = Parent[k];
    }
  }
}
```

### 6ï¸âƒ£ call / apply / bind

```js
fn.call(obj, arg1, arg2);    // ç«‹å³è°ƒç”¨
fn.apply(obj, [arg1, arg2]); // ç«‹å³è°ƒç”¨ï¼Œå‚æ•°æ•°ç»„
let b = fn.bind(obj);        // è¿”å›æ–°å‡½æ•°ï¼Œå¯å»¶è¿Ÿè°ƒç”¨
```

```js
class Person {
  constructor(name, age) {
    this.name = name
    this.age = age
  }
  sayHello() { // æ™®é€šå‡½æ•°ç»‘å®šåœ¨æ„é€ å‡½æ•°åŸå‹(\_proto\_)ä¸Š
    console.log(this.name)
  }
  myAge = () => { // ç®­å¤´å‡½æ•°åœ¨æ„é€ å‡½æ•°ä¸Š
    console.log(this.age)
  }
}
const p = new Person('hello', 18)
p.sayHello() // hello
p.myAge() // 18
console.log(p.hasOwnProperty('sayHello')) // false
console.log(p.__proto__.hasOwnProperty('sayHello')) // true
console.log(p.hasOwnProperty('myAge')) // true
console.log(p.__proto__.hasOwnProperty('myAge')) // false
```
### 7ï¸âƒ£ ES6 æ–°ç‰¹æ€§

#### class

- æ–¹æ³•ä¸å¯æšä¸¾
- å¿…é¡»ç”¨ `new` è°ƒç”¨
- ä¸å­˜åœ¨å˜é‡æå‡
- é»˜è®¤ä¸¥æ ¼æ¨¡å¼
- å­ç±»å¿…é¡»åœ¨ constructor ä¸­è°ƒç”¨ `super()`

#### ç®­å¤´å‡½æ•°

- æ²¡æœ‰ `this`ï¼Œç»§æ‰¿å¤–éƒ¨ä½œç”¨åŸŸ
- ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°

#### Map vs Object

|          | Map          | Object          |
| -------- | ------------ | --------------- |
| key ç±»å‹ | ä»»æ„         | string / symbol |
| é¡ºåº     | ä¿æŒæ’å…¥é¡ºåº | ä¸ä¿è¯          |

#### Promise

- çŠ¶æ€ï¼š`pending` â†’ `fulfilled` / `rejected`
- ç‰¹æ€§ï¼šçŠ¶æ€ä¸å¯å˜
- then è¿”å›æ–° Promise

```
.then` ç¬¬äºŒä¸ªå‚æ•° vs `.catch
```

| ç‰¹æ€§     | then ç¬¬äºŒä¸ªå‚æ•°  | catch                    |
| -------- | ---------------- | ------------------------ |
| æ•è·èŒƒå›´ | ä»…å‰ä¸€ä¸ª promise | é“¾ä¸­æ‰€æœ‰æœªå¤„ç† rejection |
| é“¾å¼è¡Œä¸º | è¿”å› resolved    | è¿”å› resolved            |
| é”™è¯¯ç©¿é€ | ä¸ç©¿é€           | ç©¿é€                     |
| æœ€ä½³åœºæ™¯ | å±€éƒ¨é”™è¯¯å¤„ç†     | å…¨å±€é”™è¯¯å¤„ç†             |

#### async / await

- åŸºäº Generator + Promise
- é‡åˆ° `await` æš‚åœå‡½æ•°ï¼Œç­‰å¾… Promise å®Œæˆ
- V8 ä¼˜åŒ–ï¼šé›¶æˆæœ¬ await

- ```js
  // ç”Ÿæˆå™¨ç‰ˆæœ¬
  function* fetchGenerator() {
    const data = yield fetch('/data');
    const processed = yield process(data);
    return processed;
  }
  
  // async/await ç‰ˆæœ¬
  async function fetchAsync() {
    const data = await fetch('/data');
    const processed = await process(data);
    return processed;
  }
  ```

#### generator

- å¯è¿­ä»£å¯¹è±¡ï¼Œæ‰‹åŠ¨æ§åˆ¶æ‰§è¡Œæµç¨‹

### 8ï¸âƒ£ this æŒ‡å‘

| è°ƒç”¨æ–¹å¼        | this æŒ‡å‘                      |
| --------------- | ------------------------------ |
| æ™®é€šå‡½æ•°        | window / undefinedï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰ |
| å¯¹è±¡æ–¹æ³•        | è°ƒç”¨å¯¹è±¡                       |
| æ„é€ å‡½æ•°        | å®ä¾‹å¯¹è±¡                       |
| ç®­å¤´å‡½æ•°        | å®šä¹‰æ—¶çš„ thisï¼ˆè¯æ³•ä½œç”¨åŸŸï¼‰    |
| call/apply/bind | å¼ºåˆ¶æŒ‡å®š                       |

### èŠ‚æµ & é˜²æŠ–
- èŠ‚æµ
	åœ¨ä¸€å®šæ—¶é—´å†…æ‰§è¡Œä¸€æ¬¡ï¼Œå‡½æ•°ä¼šå…ˆç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åä¿è¯åœ¨ä¸€å®šæ—¶é—´é—´éš”å†…åªæ‰§è¡Œä¸€æ¬¡
	
	```js
	function throttle(fn, delay) {
	  let lastTime = 0
	  return function () {
	    let nowTime = Date.now()
	    if (nowTime - lastTime > delay) {
	      setTimeout(() => {
	        fn.apply(this)
	        lastTime = nowTime
	      }, delay);
	    }
	  }
	}
	```
	
	```js
	/**
	 * ä¼˜åŒ–åçš„èŠ‚æµå‡½æ•°
	 * @param {Function} fn éœ€è¦èŠ‚æµçš„å‡½æ•°
	 * @param {number} delay èŠ‚æµæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
	 * @param {boolean} [trailing=true] æ˜¯å¦åœ¨èŠ‚æµç»“æŸåæ‰§è¡Œæœ€åä¸€æ¬¡è°ƒç”¨
	 * @returns {Function} èŠ‚æµå¤„ç†åçš„å‡½æ•°
	 */
	function throttle(fn, delay, trailing = true) {
	  let lastExecTime = 0;
	  let timer = null;
	  let pending = false;
	  
	  return function(...args) {
	    const now = Date.now();
	    const context = this;
	    
	    // ç«‹å³æ‰§è¡Œæ¡ä»¶ï¼šè·ç¦»ä¸Šæ¬¡æ‰§è¡Œè¶…è¿‡å»¶è¿Ÿæ—¶é—´
	    if (now - lastExecTime >= delay) {
	      // æ¸…é™¤ç­‰å¾…ä¸­çš„æ‰§è¡Œ
	      if (timer) {
	        clearTimeout(timer);
	        timer = null;
	      }
	      
	      // æ‰§è¡Œå‡½æ•°å¹¶æ›´æ–°æœ€åæ‰§è¡Œæ—¶é—´
	      fn.apply(context, args);
	      lastExecTime = now;
	      pending = false;
	    } 
	    // å¤„ç†å°¾éƒ¨æ‰§è¡Œ
	    else if (trailing && !pending) {
	      pending = true;
	      
	      // è®¡ç®—å‰©ä½™ç­‰å¾…æ—¶é—´
	      const remaining = delay - (now - lastExecTime);
	      
	      timer = setTimeout(() => {
	        fn.apply(context, args);
	        lastExecTime = Date.now();
	        timer = null;
	        pending = false;
	      }, remaining);
	    }
	  };
	}
	```
	
	
	
- é˜²æŠ–
	å¤šæ¬¡è§¦å‘å‡½æ•°åªä¼šåœ¨æœ€åä¸€æ¬¡æ‰§è¡Œ
	
	```js
	function debounce(fn, delay) {
	  let timer = null
	  return function () {
	    clearTimeout(timer)
	    timer = setTimeout(() => {
	      fn.apply(this)
	    }, delay)
	  }
	}
	```
	
	```js
	/**
	 * ä¼˜åŒ–çš„é˜²æŠ–å‡½æ•°
	 * @param {Function} func éœ€è¦é˜²æŠ–çš„å‡½æ•°
	 * @param {number} [wait=500] é˜²æŠ–ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
	 * @param {boolean} [immediate=false] æ˜¯å¦ç«‹å³æ‰§è¡Œ
	 * @returns {Function} é˜²æŠ–å¤„ç†åçš„å‡½æ•°
	 */
	function debounce(func, wait = 500, immediate = false) {
	  let timeout = null;
	  
	  const debounced = function(...args) {
	    const context = this;
	    const later = function() {
	      timeout = null;
	      if (!immediate) {
	        func.apply(context, args);
	      }
	    };
	    
	    const callNow = immediate && !timeout;
	    
	    // æ¸…é™¤ç°æœ‰å®šæ—¶å™¨
	    if (timeout) {
	      clearTimeout(timeout);
	    }
	    
	    // è®¾ç½®æ–°å®šæ—¶å™¨
	    timeout = setTimeout(later, wait);
	    
	    // ç«‹å³æ‰§è¡Œ
	    if (callNow) {
	      func.apply(context, args);
	    }
	  };
	  
	  // æ·»åŠ å–æ¶ˆæ–¹æ³•
	  debounced.cancel = function() {
	    if (timeout) {
	      clearTimeout(timeout);
	      timeout = null;
	    }
	  };
	  
	  return debounced;
	}
	```
	
	```typescript
	
	const debounce = (func:ReturnType<typeof Function>, wait?: number, immediate?: boolean) => {
	  wait = wait || 500
	  let timeout
	  return function() {
	    const ctx = this
	    const args = arguments
	    const callNow = immediate && !timeout
	    timeout && clearTimeout(timeout)
	    timeout = setTimeout(() => {
	      timeout = null
	      if(!immediate) {
	        func.apply(ctx, args)
	      }
	    }, wait)
	
	    if (callNow) {
	      func.apply(ctx, args)
	    }
	  }
	}
	```
	
- èŠ‚æµä¸é˜²æŠ–å¯¹æ¯”
	
	| **ç‰¹æ€§**     | **èŠ‚æµ(throttle)**       | **é˜²æŠ–(debounce)**     |
	| :----------- | :----------------------- | :--------------------- |
	| **ç›®æ ‡**     | é™åˆ¶æ‰§è¡Œé¢‘ç‡             | é™åˆ¶æ‰§è¡Œæ¬¡æ•°           |
	| **æ‰§è¡Œæ—¶æœº** | å›ºå®šé—´éš”æ‰§è¡Œ             | åœæ­¢è§¦å‘åæ‰§è¡Œ         |
	| **é€‚ç”¨åœºæ™¯** | æ»šåŠ¨ã€è°ƒæ•´å¤§å°ã€é¼ æ ‡ç§»åŠ¨ | æœç´¢è¾“å…¥ã€çª—å£è°ƒæ•´ç»“æŸ |
	| **ç«‹å³æ‰§è¡Œ** | æ€»æ˜¯ç«‹å³é¦–æ¬¡æ‰§è¡Œ         | å¯é…ç½®æ˜¯å¦ç«‹å³æ‰§è¡Œ     |
	| **å°¾éƒ¨æ‰§è¡Œ** | å¯é…ç½®æ˜¯å¦å°¾éƒ¨æ‰§è¡Œ       | æ€»æ˜¯å°¾éƒ¨æ‰§è¡Œ           |
	| **æ‰§è¡Œæ¬¡æ•°** | ä¿è¯å›ºå®šé¢‘ç‡æ‰§è¡Œ         | åªæ‰§è¡Œæœ€åä¸€æ¬¡         |
	| **å†…å­˜å ç”¨** | è¾ƒä½                     | è¾ƒé«˜ï¼ˆéœ€ç»´æŠ¤å®šæ—¶å™¨ï¼‰   |
	
- ```mermaid
  sequenceDiagram
      participant ç”¨æˆ·æ“ä½œ
      participant èŠ‚æµå‡½æ•°
      participant é˜²æŠ–å‡½æ•°
      
      ç”¨æˆ·æ“ä½œ->>èŠ‚æµå‡½æ•°: è§¦å‘äº‹ä»¶
      èŠ‚æµå‡½æ•°->>èŠ‚æµå‡½æ•°: ç«‹å³æ‰§è¡Œï¼ˆé¦–æ¬¡ï¼‰
      
      ç”¨æˆ·æ“ä½œ->>èŠ‚æµå‡½æ•°: å¿«é€Ÿè¿ç»­è§¦å‘
      èŠ‚æµå‡½æ•°->>èŠ‚æµå‡½æ•°: å¿½ç•¥ä¸­é—´è§¦å‘
      
      ç”¨æˆ·æ“ä½œ->>èŠ‚æµå‡½æ•°: åœæ­¢è§¦å‘
      èŠ‚æµå‡½æ•°->>èŠ‚æµå‡½æ•°: å°¾éƒ¨æ‰§è¡Œï¼ˆå¯é€‰ï¼‰
      
      ç”¨æˆ·æ“ä½œ->>é˜²æŠ–å‡½æ•°: è§¦å‘äº‹ä»¶
      é˜²æŠ–å‡½æ•°->>é˜²æŠ–å‡½æ•°: ç«‹å³æ‰§è¡Œï¼ˆå¯é€‰ï¼‰
      
      ç”¨æˆ·æ“ä½œ->>é˜²æŠ–å‡½æ•°: å¿«é€Ÿè¿ç»­è§¦å‘
      é˜²æŠ–å‡½æ•°->>é˜²æŠ–å‡½æ•°: é‡ç½®å®šæ—¶å™¨
      
      ç”¨æˆ·æ“ä½œ->>é˜²æŠ–å‡½æ•°: åœæ­¢è§¦å‘
      é˜²æŠ–å‡½æ•°->>é˜²æŠ–å‡½æ•°: ç­‰å¾…å»¶è¿Ÿåæ‰§è¡Œ
  ```

- åœºæ™¯
	èŠ‚æµï¼šæ»šåŠ¨åŠ è½½æ›´å¤šï¼Œé«˜é¢‘ç‚¹å‡»ï¼Œè¡¨å•é‡å¤æäº¤
	é˜²æŠ–ï¼šæœç´¢æ¡†è¾“å…¥

### 10ï¸âƒ£ äº‹ä»¶ä»£ç†

- åŸç†ï¼šäº‹ä»¶å†’æ³¡ + å§”æ‰˜
- ä¼˜ç‚¹ï¼š
  - å‡å°‘ DOM æ³¨å†Œï¼Œæé«˜æ€§èƒ½
  - åŠ¨æ€å­å…ƒç´ è‡ªåŠ¨ç»‘å®šäº‹ä»¶

![](https://i-coder.oss-cn-beijing.aliyuncs.com/files/36c2fe36cb4dc8c6b99ec91bb3352572_webp.webp)

### 11ï¸âƒ£ new ä¸€ä¸ªå¯¹è±¡çš„å…¨è¿‡ç¨‹

1. åˆ›å»ºç©ºå¯¹è±¡ `obj`
2. `obj.__proto__ = æ„é€ å‡½æ•°.prototype`
3. æ„é€ å‡½æ•°å†…éƒ¨ `this æŒ‡å‘ obj` 
4. è¿”å›å¯¹è±¡ï¼š
   - è¿”å›éå¯¹è±¡ï¼šè¿”å› `obj`
   - è¿”å›å¯¹è±¡ï¼šè¿”å›è¯¥å¯¹è±¡

### è‡ªå®šä¹‰new
```js
function newFun(...args) {
  // å–å‡ºargsçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ç›®æ ‡çš„æ„é€ å‡½æ•°
  const constructor = args.shift() // [Function: Person]ï¼ˆPersonä¸ºç›®æ ‡å‡½æ•°åç§°ï¼‰
  // åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡objï¼Œä¸”ç»§æ‰¿æ„é€ å‡½æ•°çš„prototypeå±æ€§
  const obj = Object.create(constructor.prototype) // obj.__proto__ === constructor.prototype
  // å°†æ„é€ å‡½æ•°å†…éƒ¨thisæŒ‡å‘objï¼Œå¹¶æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œè¿”å›ç»“æœ
  const result = constructor.apply(obj, args)
	// åˆ¤æ–­è¿”å›ç»“æœï¼Œå¦‚æœä¸ºå¯¹è±¡ç±»å‹ï¼Œåˆ™è¿”å›resultï¼›å¦åˆ™è¿”å›obj
  return (typeof result === 'object' && result !== null) ? result : obj
}
```
### æ·±æ‹·è´ & æµ…æ‹·è´
- æµ…æ‹·è´
	å¤åˆ¶ä¸€å±‚å¯¹è±¡çš„å±æ€§ï¼Œå¹¶ä¸åŒ…æ‹¬å¯¹è±¡é‡Œå¼•ç”¨ç±»å‹çš„æ•°æ®ï¼›å½“æ”¹å˜æ‹·è´å¯¹è±¡çš„å¼•ç”¨ç±»å‹æ—¶ï¼Œæºå¯¹è±¡ä¹Ÿä¼šæ”¹å˜ï¼›
- æ·±æ‹·è´
	é‡æ–°å¼€è¾Ÿä¸€ä¸ªç©ºé—´ï¼Œéœ€è¦é€’å½’æ‹·è´å¯¹è±¡é‡Œçš„å¼•ç”¨ï¼›ç›´åˆ°å­å±æ€§éƒ½ä¸ºåŸºæœ¬ç±»å‹ï¼›
	ä¸¤ä¸ªå¯¹è±¡å¯¹åº”ä¸¤ä¸ªä¸åŒçš„åœ°å€ï¼Œäº’ä¸å½±å“ï¼›
	- å®ç°
        - JSON.parse() JSON.stringify()
            ç¼ºç‚¹ï¼š 
            - æ‹·è´ä¹‹åï¼Œå¯¹è±¡çš„æ„é€ å‡½æ•°éƒ½ä¼šå˜æˆObject
            - RegExpæ— æ³•å®ç°æ‹·è´
            - functionç›´æ¥æ¶ˆå¤±
            - è‡ªå®šä¹‰
```js
function deepCopy(obj) {
  let result = Array.isArray(obj) ? [] : {};
  for (let key in obj) {
    if (obj.hasOwnProperty(key)) {
      if (typeof obj[key] === 'object' && obj[key]!==null) {
        result[key] = deepCopy(obj[key]);   //é€’å½’å¤åˆ¶
      } else {
        result[key] = obj[key];
      }
    }
  }
  return result;
}
```
```js
a = window.structuredClone(b);
```

```js
const _ = require("lodash");
const clone = _.cloneDeep(yourObject);
```

### æ•°ç»„è½¬treeç»“æ„

```js
/**
 * åˆ©ç”¨å¯¹è±¡æµ…æ‹·è´ éé€’å½’å®ç°ï¼Œæ—¶é—´å¤æ‚åº¦O(n)
 * @param {åŸæ•°ç»„} arr
 * @param {æ ¹èŠ‚ç‚¹id} rootId
 * @param {id} id
 * @param {pid} pid
 */
function jsonArray2Tree(arr, rootId, id, pid) {
  // æµ…å¤åˆ¶å‡ºä¸€ä»½æ•°æ®å¹¶åŠ ä¸Š children å­—æ®µ
  let obj = {}
  arr.forEach(v => {
    obj[v[id]] = v
    obj[v[id]].children = []
  })
  let tree = []
  arr.forEach(v => {
    if (v[pid] == rootId) {
      tree.push(v)
    }
    // æ‹¿æ­¤åˆ»å¾ªç¯å€¼çš„ pid å»å¤åˆ¶æ•°æ®é‡Œé¢æ‰¾åˆ°å¯¹åº”çˆ¶çº§ç„¶åå¡åˆ°å®ƒçš„ children ä¸­
    obj[v[pid]] && obj[v[pid]].children.push(v)
  })
  return tree
}
```
### å†…å­˜æ³„æ¼

å¸¸è§åŸå› ï¼š

1. **é—­åŒ…**ï¼šé—­åŒ…å¼•ç”¨å¤–éƒ¨å˜é‡ï¼Œå¯¼è‡´å˜é‡æ— æ³•é‡Šæ”¾ã€‚
2. **å¾ªç¯å¼•ç”¨**ï¼šå¯¹è±¡ä¹‹é—´äº’ç›¸å¼•ç”¨ï¼ŒGCæ— æ³•å›æ”¶ã€‚
3. **DOMäº‹ä»¶æœªè§£ç»‘**ï¼šå°¤å…¶åœ¨ SPA é¡µé¢é¢‘ç¹åˆ›å»ºé”€æ¯å…ƒç´ ã€‚
4. **å…¨å±€å˜é‡**ï¼šé•¿æœŸå ç”¨å…¨å±€å¯¹è±¡ï¼Œæ— æ³•é‡Šæ”¾ã€‚

### åƒåœ¾å›æ”¶
- æ ‡è®°æ¸…é™¤
	å½“å˜é‡è¿›å…¥æ‰§è¡Œç¯å¢ƒæ—¶ï¼Œè¢«æ ‡è®°ä¸ºâ€˜è¿›å…¥ç¯å¢ƒâ€™ï¼›
	å½“å˜é‡ç¦»å¼€æ‰§è¡Œç¯å¢ƒæ—¶ï¼Œä¼šè¢«æ ‡è®°ä¸ºâ€˜ç¦»å¼€ç¯å¢ƒâ€™ï¼›
	åƒåœ¾å›æ”¶å™¨ä¼šé”€æ¯é‚£äº›å¸¦æ ‡è®°çš„å€¼ï¼Œå¹¶å›æ”¶ä»–ä»¬å ç”¨çš„å†…å­˜ç©ºé—´
- è°·æ­Œæµè§ˆå™¨ï¼š
	â€œæŸ¥æ‰¾å¼•ç”¨â€ï¼Œæµè§ˆå™¨ä¸å®šæ—¶å»æŸ¥æ‰¾å½“å‰å†…å­˜çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰è¢«å ç”¨äº†ï¼Œæµè§ˆå™¨ä¼šå›æ”¶å®ƒï¼›å¦‚æœè¢«å ç”¨ï¼Œå°±ä¸èƒ½å›æ”¶ã€‚
- IEæµè§ˆå™¨
	â€œå¼•ç”¨è®¡æ•°æ³•â€ï¼Œå½“å‰å†…å­˜è¢«å ç”¨ä¸€æ¬¡ï¼Œè®¡æ•°ç´¯åŠ 1æ¬¡ï¼Œç§»é™¤å ç”¨å°±å‡1ï¼Œå‡åˆ°0æ—¶ï¼Œæµè§ˆå™¨å°±å›æ”¶å®ƒã€‚
### `==` vs `===`

| ç‰¹æ€§         | `==`                          | `===`                |
| ------------ | ----------------------------- | -------------------- |
| ç±»å‹è½¬æ¢     | ä¼šè¿›è¡Œç±»å‹è½¬æ¢                | ä¸è¿›è¡Œç±»å‹è½¬æ¢       |
| å¼•ç”¨ç±»å‹æ¯”è¾ƒ | æ¯”è¾ƒåœ°å€                      | æ¯”è¾ƒåœ°å€             |
| ç‰¹æ®Šæƒ…å†µ     | `null == undefined` ä¸º `true` | éœ€è¦ç±»å‹å’Œå€¼å®Œå…¨ç›¸ç­‰ |
| æ¨èä½¿ç”¨     | å°‘ç”¨ï¼Œé¿å…éšå¼è½¬æ¢            | æ¨èä½¿ç”¨             |

### `<script>` å±æ€§ï¼šasync & defer

| å±æ€§  | è§£æé¡ºåº       | æ‰§è¡Œé¡ºåº               | æ˜¯å¦é˜»å¡ DOM         |
| ----- | -------------- | ---------------------- | -------------------- |
| æ™®é€š  | HTMLè§£ææ—¶æš‚åœ | ä¸‹è½½å®Œç«‹å³æ‰§è¡Œ         | æ˜¯                   |
| async | HTMLè§£æç»§ç»­   | ä¸‹è½½å®Œç«‹å³æ‰§è¡Œ         | å¦ï¼Œä½†æ‰§è¡Œä¼šæš‚åœè§£æ |
| defer | HTMLè§£æç»§ç»­   | HTMLè§£æå®Œæˆåé¡ºåºæ‰§è¡Œ | å¦                   |

- æ™®é€š
	æµè§ˆå™¨åœ¨è§£æHTMLæ—¶ï¼Œè‹¥é‡åˆ°ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å±æ€§çš„scriptæ ‡ç­¾ï¼Œå°±ä¼šæš‚åœè§£æï¼›
	å…ˆå‘é€ç½‘ç»œè¯·æ±‚ï¼Œè·å–è¯¥jsè„šæœ¬å†…å®¹ï¼Œç„¶åè®©jså¼•æ“æ‰§è¡Œè¯¥ä»£ç ï¼›
	ä»£ç æ‰§è¡Œå®Œæ¯•åæ¢å¤è§£æï¼›
	![](https://i-coder.oss-cn-beijing.aliyuncs.com/files/20220213000205.png)
- async
	è¯·æ±‚è¯¥è„šæœ¬çš„ç½‘ç»œè¯·æ±‚æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡æµè§ˆå™¨è§£æHTMLä»£ç ï¼›
	ä¸€æ—¦ç½‘ç»œè¯·æ±‚å›æ¥ï¼Œè‹¥HTMLè¿˜æ²¡è§£æå®Œï¼Œæµè§ˆå™¨ä¼šæš‚åœè§£æï¼›
	å…ˆè®©jså¼•æ“æ‰§è¡Œä»£ç ï¼›
	æ‰§è¡Œå®Œæ¯•åå†è¿›è¡Œè§£æï¼›
	![](https://i-coder.oss-cn-beijing.aliyuncs.com/files/20220213000403.png)
- defer
	è·å–è¯¥è„šæœ¬çš„ç½‘ç»œè¯·æ±‚ä¹Ÿæ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡æµè§ˆå™¨ä»‹è§£æHTMLï¼›
	ä¸€æ—¦ç½‘ç»œè¯·æ±‚å›æ¥ï¼Œè‹¥æ­¤æ—¶HTMLè¿˜æ²¡è§£æå®Œï¼›
	æµè§ˆå™¨ç­‰å¾…HTMLè§£æå®Œï¼Œåœ¨æ‰§è¡Œjsä»£ç ï¼›
	![](https://i-coder.oss-cn-beijing.aliyuncs.com/files/20220213000834.png)

### MutationObserver

#### ä½œç”¨

ç”¨äºå¼‚æ­¥ç›‘å¬DOMæ ‘çš„å˜åŒ–

```mermaid
sequenceDiagram
    participant æµè§ˆå™¨ as æµè§ˆå™¨å¼•æ“
    participant JS as JavaScriptçº¿ç¨‹
    participant MO as MutationObserver
    
    æµè§ˆå™¨->>MO: æ£€æµ‹åˆ°DOMå˜åŒ–
    MO->>æµè§ˆå™¨: å°†å˜åŒ–è®°å½•åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—
    JS->>MO: å½“å‰JSæ‰§è¡Œæ ˆæ¸…ç©º
    MO->>JS: è§¦å‘å›è°ƒå‡½æ•°(æ‰¹é‡å¤„ç†å˜åŒ–)
```

#### ä½¿ç”¨æ–¹å¼

- åˆ›å»ºè§‚å¯Ÿè€…æ¨¡å¼

  ```js
  // åˆ›å»ºå›è°ƒå‡½æ•°
  // (æ‰€æœ‰è¢«è§¦å‘æ”¹åŠ¨çš„ MutationRecord å¯¹è±¡æ•°ç»„, è°ƒç”¨è¯¥å‡½æ•°çš„ MutationObserver å¯¹è±¡)
  const callback = (mutationsList, observer) => {
      for(const mutation of mutationsList) {
          if (mutation.type === 'childList') {
              console.log('å­èŠ‚ç‚¹å˜åŒ–:', mutation.addedNodes, mutation.removedNodes);
          }
          else if (mutation.type === 'attributes') {
              console.log(`å±æ€§ ${mutation.attributeName} å˜åŒ–:`, 
                           mutation.oldValue, 
                           mutation.target.getAttribute(mutation.attributeName));
          }
      }
  };
  
  // åˆ›å»ºè§‚å¯Ÿè€…å®ä¾‹
  const observer = new MutationObserver(callback);
  ```

- é…ç½®è§‚å¯Ÿé€‰é¡¹

  ```js
  const config = {
      subtree: true,         // ç›‘è§†æ‰€æœ‰åä»£èŠ‚ç‚¹
      childList: true,       // ç›‘è§†å­èŠ‚ç‚¹å˜åŒ–
      attributes: true,      // ç›‘è§†å±æ€§å˜åŒ–
      attributeOldValue: true, // è®°å½•æ—§å±æ€§å€¼
      attributeFilter: ['class', 'data-id'], // åªç›‘è§†ç‰¹å®šå±æ€§
      characterData: false,  // ä¸ç›‘è§†æ–‡æœ¬èŠ‚ç‚¹å˜åŒ–
      characterDataOldValue: false
  };
  ```

- å¯åŠ¨å’Œåœæ­¢è§‚å¯Ÿ

  ```js
  // å¼€å§‹è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹
  const targetNode = document.getElementById('app');
  observer.observe(targetNode, config);
  
  // åœæ­¢è§‚å¯Ÿ
  observer.disconnect();
  
  // è·å–æœªå¤„ç†çš„å˜æ›´
  const mutations = observer.takeRecords();
  ```

  ```js
  // åŠ¨æ€ä¿®æ”¹ DOM æµ‹è¯•
  const newDiv = document.createElement('div');
  newDiv.textContent = 'Hello MutationObserver';
  targetNode.appendChild(newDiv); // ä¼šè§¦å‘ childList å›è°ƒ
  
  targetNode.setAttribute('data-test', '123'); // ä¼šè§¦å‘ attributes å›è°ƒ
  
  newDiv.textContent = 'Text updated'; // ä¼šè§¦å‘ characterData å›è°ƒ
  ```

  

- æ‰¹é‡å˜åŒ–å¤„ç†

  ```js
  const observer = new MutationObserver((mutations) => {
      // ä½¿ç”¨requestAnimationFrameå‡å°‘é‡ç»˜
      requestAnimationFrame(() => {
          console.log(`æ‰¹é‡å¤„ç† ${mutations.length} ä¸ªå˜æ›´`);
          // å®é™…å¤„ç†é€»è¾‘...
      });
  });
  ```


### requestIdleCallback & requestAnimationFrame & setTimeout

- #### setTimeout

  - å®šä¹‰
    - åœ¨æŒ‡å®šå»¶è¿Ÿåæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå±äºå®ä»»åŠ¡
    
  - ç‰¹ç‚¹
    - æ— æ³•ä¿è¯ç²¾ç¡®æ‰§è¡Œæ—¶é—´ï¼ˆå¯èƒ½å› ä¸»çº¿ç¨‹é˜»å¡è€Œå»¶è¿Ÿï¼‰
    
      JS åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå¦‚æœå®šæ—¶å™¨åˆ°æœŸæ—¶çº¿ç¨‹æ­£å¿™ï¼Œå›è°ƒåªèƒ½ç­‰åˆ°å½“å‰æ‰§è¡Œæ ˆæ¸…ç©ºåå†æ‰§è¡Œ
    
      `setTimeout(fn, 0)`ï¼Œæµè§ˆå™¨è§„å®š **æœ€å°å»¶è¿Ÿ 4ms**
    
    - é€‚åˆéè§†è§‰ç›¸å…³çš„å»¶è¿Ÿä»»åŠ¡
    
  - ç¼ºç‚¹
    - é¢‘ç¹ä½¿ç”¨å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼ˆå¦‚ï¼šåŠ¨ç”»å¡é¡¿ï¼‰
    - ä¸å±å¹•åˆ·æ–°ç‡ä¸åŒæ­¥ï¼Œæ˜“å¯¼è‡´åŠ¨ç”»ä¸¢å¤±

- #### requestAnimationFrame

  - å®šä¹‰

    - åœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜å‰æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œä¸“é—¨ä¸ºé«˜æ€§èƒ½åŠ¨ç”»è®¾è®¡

  - ç‰¹ç‚¹

    - ä¸å±å¹•åˆ·æ–°ç‡åŒæ­¥ï¼ˆé€šå¸¸60HZï¼Œå³æ¯16.7msæ‰§è¡Œä¸€æ¬¡ï¼‰
    - è‡ªåŠ¨æš‚åœåœ¨åå°æ ‡ç­¾é¡µï¼ŒèŠ‚çœèµ„æº
    - æä¾›ç²¾ç¡®çš„æ—¶é—´æˆ³å‚æ•°ï¼ˆDOMHighResTimeStampï¼‰ï¼Œç”¨äºè®¡ç®—å¸§ç‡

  - åº”ç”¨åœºæ™¯

    - åŠ¨ç”»ï¼ˆCSSã€canvasï¼‰
    - é«˜é¢‘è§†è§‰æ›´æ–°
    - å¸ƒå±€æµ‹é‡ï¼ˆé¿å…å¼ºåˆ¶åŒæ­¥å¸ƒå±€ï¼‰

  - ç¤ºä¾‹

    - ä¸€æ¬¡æ€§æ¸²æŸ“åä¸‡æ¡æ•°æ®
      - æ¯æ¬¡ç”µè„‘å±å¹• 16.7ms ååˆ·æ–°ä¸€ä¸‹ï¼Œå®šæ—¶å™¨å°±ä¼šäº§ç”Ÿ 20 ä¸ª`li`ï¼Œ`dom`ç»“æ„çš„å‡ºç°å’Œå±å¹•çš„åˆ·æ–°ä¿æŒäº†ä¸€è‡´
      - `fragment`æ˜¯è™šæ‹Ÿæ–‡æ¡£ç¢ç‰‡ï¼Œæˆ‘ä»¬ä¸€æ¬¡`for`å¾ªç¯äº§ç”Ÿ 20 ä¸ª`li`çš„è¿‡ç¨‹ä¸­å¯ä»¥å…¨éƒ¨æŠŠçœŸå®`dom`æŒ‚è½½åˆ°`fragment`ä¸Šï¼Œç„¶åå†æŠŠ`fragment`æŒ‚è½½åˆ°çœŸå®`dom`ä¸Šï¼Œè¿™æ ·åŸæ¥éœ€è¦å›æµåä¸‡æ¬¡ï¼Œç°åœ¨åªéœ€è¦å›æµ`100000 / 20`æ¬¡

    [100000åˆ—è¡¨æ¸²æŸ“ - ç ä¸Šæ˜é‡‘](https://code.juejin.cn/pen/7538081449229058058)

    ```js
    <script>
        const total = 100000
        let ul = document.getElementById('container')
        let once = 20
        let page = total / once
        function loop(curTotal) {
            if (curTotal <= 0) return 
            let pageCount = Math.min(curTotal, once) 
            window.requestAnimationFrame(() => {
                let fragment = document.createDocumentFragment() // åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ–‡æ¡£ç¢ç‰‡
                for (let i = 0; i < pageCount; i++) {
                    let li = document.createElement('li')
                    li.innerHTML = ~~(Math.random() * total)
                    fragment.appendChild(li) // æŒ‚åˆ°fragmentä¸Š
                }
                ul.appendChild(fragment) // ç°åœ¨æ‰å›æµ
                loop(curTotal - pageCount)
            })
        }
        loop(total)
    </script>
    ```

    

- #### requestIdleCallback

  - å®šä¹‰
    - åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æœŸæ‰§è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œé¿å…é˜»å¡å…³é”®æ¸²æŸ“
  - ç‰¹ç‚¹
    - æ¥æ”¶IdleDealineå‚æ•°ï¼šåŒ…å«
      - timeRemaining()ï¼šå½“å‰å¸§å‰©ä½™ç©ºé—²æ—¶é—´ï¼ˆé€šå¸¸<=50msï¼‰
      - didTimeoutï¼šä»»åŠ¡æ˜¯å¦å› è¶…æ—¶è¢«å¼ºåˆ¶æ‰§è¡Œ
    - å¯é…ç½®è¶…æ—¶æ—¶é—´ï¼ˆ{timeoutï¼š N}ï¼‰ï¼Œè¶…æ—¶åå¼ºåˆ¶æ‰§è¡Œ
  - åº”ç”¨åœºæ™¯
    - éå…³é”®ä»»åŠ¡ï¼ˆå¦‚åŸ‹ç‚¹ï¼Œæ•°æ®é¢„åŠ è½½ï¼‰
    - è€—æ—¶è®¡ç®—ï¼ˆæ‹†åˆ†å¤šä¸ªç©ºé—²ä»»åŠ¡æ‰§è¡Œï¼‰
    - åå°æ•°æ®åŒæ­¥ï¼ˆå¦‚ä¿å­˜è‰ç¨¿ï¼‰

  - ç¤ºä¾‹

    ```js
    requestIdleCallback((deadline) => {
      while (deadline.timeRemaining() > 0) {
        doLowPriorityTask(); // æ‹†åˆ†ä»»åŠ¡
      }
    }, { timeout: 2000 }); // 2ç§’è¶…æ—¶
    ```

- #### åŒºåˆ«

  | **ç‰¹æ€§**           | `setTimeout`   | `requestAnimationFrame` (rAF) | `requestIdleCallback` (rIC) |
  | :----------------- | :------------- | :---------------------------- | :-------------------------- |
  | **è§¦å‘æ—¶æœº**       | æŒ‡å®šå»¶è¿Ÿå     | ä¸‹ä¸€å¸§æ¸²æŸ“å‰                  | æµè§ˆå™¨ç©ºé—²æ—¶                |
  | **æ‰§è¡Œé¢‘ç‡**       | è‡ªå®šä¹‰         | åŒæ­¥å±å¹•åˆ·æ–°ç‡ï¼ˆâ‰ˆ60fpsï¼‰      | å–å†³äºç©ºé—²æ—¶é—´              |
  | **æ˜¯å¦é˜»å¡æ¸²æŸ“**   | å¯èƒ½é˜»å¡       | ä¸é˜»å¡ï¼ˆåœ¨æ¸²æŸ“å‰æ‰§è¡Œï¼‰        | å®Œå…¨ä¸é˜»å¡                  |
  | **é€‚ç”¨ä»»åŠ¡ä¼˜å…ˆçº§** | ä¸­/ä½          | **é«˜**ï¼ˆè§†è§‰æ›´æ–°ï¼‰            | **ä½**ï¼ˆåå°ä»»åŠ¡ï¼‰          |
  | **èµ„æºæ¶ˆè€—**       | å¯èƒ½æµªè´¹èµ„æº   | é«˜æ•ˆï¼ˆåå°è‡ªåŠ¨æš‚åœï¼‰          | é«˜æ•ˆï¼ˆä»…ç©ºé—²æ—¶è¿è¡Œï¼‰        |
  | **ç²¾ç¡®æ—¶é—´æ§åˆ¶**   | âŒ å»¶è¿Ÿä¸ç²¾ç¡®   | âœ… æä¾›é«˜ç²¾åº¦æ—¶é—´æˆ³            | âœ… æä¾›å‰©ä½™ç©ºé—²æ—¶é—´          |
  | **å…¸å‹åœºæ™¯**       | å»¶è¿Ÿé€»è¾‘ã€è½®è¯¢ | åŠ¨ç”»ã€å¸ƒå±€æµ‹é‡                | æ—¥å¿—ä¸ŠæŠ¥ã€é¢„åŠ è½½            |

- #### ç¤ºä¾‹

  è®¡ç®—ä»0åˆ°2000000000çš„ç´¯åŠ 
  
  start = 0; end = 2000000000;

  - Web Worker

    ```js
    function runWithWorker() {
        const w1 = new Worker('./index-worker.js');
        w1.postMessage({ start, end });
        w1.onmessage = (event) => {
            console.log('main', event)
        }
    }
    // index-worker.js
    self.onmessage = function(event) {
      console.log('web worker',event)
      const { start, end } = event.data;
      let sum = 0;
      for(let i=start;i<=end;i++) {
        sum += i;
      }
      self.postMessage('sum', sum)
    }
    ```

    

  - requestAnimationFrame

    ```js
    function runWithRAF() {
      // åˆå§‹åŒ–å˜é‡
      let current = start; // å½“å‰å¤„ç†çš„ä½ç½®
      let sum = 0; // ç´¯åŠ ç»“æœ
      const chunkSize = 10000000; // æ¯å—å¤„ç†1åƒä¸‡ä¸ªæ•°å­—
      function doChunk() {
        // è®°å½•å¸§å¼€å§‹æ—¶é—´
        const frameStart = performance.now();
        // è®¡ç®—å½“å‰å—çš„ç»“æŸä½ç½®
        const chunkEnd = Math.min(current + chunkSize, end);
        // å¤„ç†å½“å‰å—
        while (current <= chunkEnd) {
          sum += current++; // ç´¯åŠ æ•°å­—å¹¶ç§»åŠ¨æŒ‡é’ˆ
        }
        // æ›´æ–°è¿›åº¦
        const progress = (current / end) * 100;
        updateProgress(progress, current);
        // æ£€æŸ¥æ˜¯å¦å®Œæˆ
        if (current > end) {
          showResult(sum);
          return;
        }
        // æ™ºèƒ½è°ƒåº¦ä¸‹ä¸€å—
        const elapsed = performance.now() - frameStart;
        if (elapsed < 10) {
          doChunk(); // å½“å‰å¸§è¿˜æœ‰æ—¶é—´ï¼Œç«‹å³æ‰§è¡Œä¸‹ä¸€å—
        } else {
          requestAnimationFrame(doChunk); // ç­‰å¾…ä¸‹ä¸€å¸§
        }
      }
      // å¯åŠ¨ç¬¬ä¸€å—
      requestAnimationFrame(doChunk);
    }
    ```

    - ä¸ºä»€ä¹ˆif (elapsed < 10)

      1. å¸§æ—¶é—´é¢„ç®—åˆ†é…

      | æ—¶é—´æ®µ         | åˆ†é…æ—¶é—´ | ç”¨é€”                       |
      | :------------- | :------- | :------------------------- |
      | JavaScriptæ‰§è¡Œ | â‰¤10ms    | æ‰§è¡Œåº”ç”¨é€»è¾‘ã€è®¡ç®—ä»»åŠ¡     |
      | æµè§ˆå™¨æ¸²æŸ“å·¥ä½œ | â‰¥6.67ms  | æ ·å¼è®¡ç®—ã€å¸ƒå±€ã€ç»˜åˆ¶ã€åˆæˆ |
      | **æ€»å¸§æ—¶é—´**   | 16.67ms  | å®ç°60FPSçš„æµç•…ä½“éªŒ        |

    `if (elapsed < 10)` è¿™ä¸ªæ¡ä»¶åˆ¤æ–­æ˜¯ç¡®ä¿é¡µé¢æµç•…æ€§çš„å…³é”®ä¼˜åŒ–ç­–ç•¥ï¼š

    1. **å®‰å…¨è¾¹ç•Œ**ï¼šä¸ºæµè§ˆå™¨æ¸²æŸ“ä¿ç•™æœ€å°‘6msæ—¶é—´
    2. **æ€§èƒ½å¹³è¡¡**ï¼šåœ¨å……åˆ†åˆ©ç”¨å¸§æ—¶é—´å’Œä¿è¯æµç•…æ€§ä¹‹é—´å–å¾—å¹³è¡¡
    3. **é¢„é˜²å¡é¡¿**ï¼šé¿å…JavaScriptç‹¬å å¸§æ—¶é—´å¯¼è‡´ä¸¢å¸§
    4. **å“åº”ä¿éšœ**ï¼šç¡®ä¿ç”¨æˆ·äº¤äº’èƒ½å¾—åˆ°åŠæ—¶å“åº”

    è¿™ä¸ª10msé˜ˆå€¼æ˜¯Webæ€§èƒ½ä¼˜åŒ–çš„æœ€ä½³å®è·µä¹‹ä¸€ï¼Œå®ƒæºè‡ªå¤šå¹´ç§¯ç´¯çš„ç»éªŒå’Œå¯¹æµè§ˆå™¨æ¸²æŸ“ç®¡çº¿çš„æ·±å…¥ç†è§£

  - requestIdleCallback

    ```js
    function runWithRIC () {
        let sum = 0;
        let current = 0;
        const chunkSize = 1000000; // æ¯å—å¤„ç†1ç™¾ä¸‡æ¬¡è®¡ç®—
        function doChunk (deadline) {
            while (current <= end && deadline.timeRemaining() > 0) {
                const chunkEnd = Math.min(current + chunkSize, end);
                for (let i = current; i <= chunkEnd; i++) {
                    sum += i;
                }
                current = chunkEnd + 1;
                // æ›´æ–°è¿›åº¦
                const progress = (current / end) * 100;
                console.log(progress);
                if (current > end) {
                    console.log('è®¡ç®—å®Œæˆ', sum);
                    return;
                }
            }
            requestIdleCallback(doChunk);
        }
        requestIdleCallback(doChunk);
    }
    ```

    