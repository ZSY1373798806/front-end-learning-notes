

# æ€§èƒ½ä¼˜åŒ–

## é¡µé¢å·¥ç¨‹ä¼˜åŒ–

> ç½‘ç»œåè®®ã€èµ„æºé…ç½®ã€æµè§ˆå™¨æ€§èƒ½ã€ç¼“å­˜ç­‰ï¼›
>
> å›¾ç‰‡æ‡’åŠ è½½ã€é›ªç¢§å›¾ï¼›
>
> ä½¿ç”¨prefetch/preloadé¢„åŠ è½½ï¼›
>
> tree shakingä»£ç ç˜¦èº«;



### åŠ¨ç”»æ€§èƒ½ä¼˜åŒ–

- CSS3åŠ¨ç”»ä¼šæ¯”åŸºäºjavascriptå®ç°çš„åŠ¨ç”»æ•ˆç‡æ›´é«˜ï¼Œä¼˜å…ˆä½¿ç”¨CSS3åŠ¨ç”»æ•ˆæœ
- ä½¿ç”¨CSS3å®ç°åŠ¨ç”»æ—¶ï¼Œè€ƒè™‘å¼€å¯GPUåŠ é€Ÿ
- ä¼˜å…ˆä½¿ç”¨æ¶ˆè€—æœ€ä½çš„transformå’Œopacityä¸¤ä¸ªå±æ€§
- ä½¿ç”¨will-changeå±æ€§
- ç‹¬ç«‹åˆæˆå±‚ï¼Œå‡å°‘ç»˜åˆ¶åŒºåŸŸ
- å¯¹äºåªèƒ½ä½¿ç”¨javascriptå®ç°åŠ¨ç”»æ•ˆæœçš„æƒ…å†µï¼Œè€ƒè™‘ä½¿ç”¨requestAnimationFrameã€requeststldleCallback API
- æ‰¹é‡è¿›è¡Œæ ·å¼å˜æ¢ï¼Œå‡å°‘å¸ƒå±€æŠ–åŠ¨

## ä»£ç ç»†èŠ‚ä¼˜åŒ–

> javascriptå¯¹DOMçš„æ“ä½œã€å®¿ä¸»ç¯å¢ƒçš„å•çº¿ç¨‹ç›¸å…³å†…å®¹ç­‰ã€‚

### æ¡ˆä¾‹1 å¸ƒå±€æŠ–åŠ¨é—®é¢˜

> å¸ƒå±€æŠ–åŠ¨æ˜¯æŒ‡ï¼šDOMå…ƒç´ è¢«javascriptå¤šæ¬¡åå¤è¯»å†™ï¼Œå¯¼è‡´æ–‡æ¡£å¤šæ¬¡æ— æ„ä¹‰é‡æ’ï¼›
>
> æµè§ˆå™¨å¾ˆæ‡’ï¼Œä¼šæ”¶é›†ï¼ˆpatchï¼‰å½“å‰æ“ä½œï¼Œç»Ÿä¸€è¿›è¡Œé‡æ’ï¼›
>
> ä½†å¦‚æœåœ¨å½“å‰æ“ä½œå®Œæˆä¹‹å‰ï¼Œä»DOMå…ƒç´ ä¸­è·å–å€¼ï¼Œä¼šè¿«ä½¿æµè§ˆå™¨ææ—©æ‰§è¡Œå¸ƒå±€æ“ä½œï¼Œç§°ä½œâ€˜å¼ºåˆ¶åŒæ­¥å¸ƒå±€â€™ï¼›
>
> å¯¼è‡´ä¸¥é‡çš„åæœ

é”™è¯¯ä»£ç 

> å¼•èµ·å¸ƒå±€æŠ–åŠ¨é—®é¢˜

```javascript
const h1 = element1.clientHeight
element1.style.height = (h1 * 2) + 'px'
const h2 = element2.clientHeight
element2.style.height = (h2 * 2) + 'px'
const h3 = element3.clientHeight
element3.style.height = (h3 * 2) + 'px'
```

ä¼˜åŒ–ä»£ç 

> ä½¿ç”¨window.requestAnimationFrameè¿›è¡Œä¼˜åŒ–
>
> window.requestAnimationFrame(callback)
>
> è¯¥æ–¹æ³•å‘Šè¯‰æµè§ˆå™¨ä½ å¸Œæœ›æ‰§è¡Œçš„æ“ä½œï¼Œå¹¶è¯·æ±‚æµè§ˆå™¨åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨åˆ¶å®šçš„å‡½æ•°æ¥æ›´æ–°

```javascript
const h1 = element1.clientHeight
requestAnimationFrame(() => {
  element1.style.height = (h1 * 2) + 'px'
})
const h2 = element2.clientHeight
requestAnimationFrame(() => {
  element2.style.height = (h2 * 2) + 'px'
})
const h3 = element3.clientHeight
requestAnimationFrame(() => {
  element3.style.height = (h3 * 2) + 'px'
})
```

#### å»¶ä¼¸é¢˜ç›®

- å®ç°window.requestAnimationFrameçš„polyfillï¼ˆå…¼å®¹æ€§ï¼‰

```javascript
if (!window.requestAnimationFrame) {
  window.requestAnimationFrame = callback => {
    const id = window.setTimeout(() => {
      callback()
    }, 1000 / 60) // 1ç§’é’Ÿ60æ¬¡ï¼ˆå¤§çº¦æ¯16.7æ¯«ç§’ä¸€æ¬¡ï¼‰ï¼ˆ60å¸§ï¼‰
    return id
  }
}
if(!window.cancelAnimationFrame) {
  window.cancelAnimationFrame = id => {
    clearTimeout(id)
  }
}
```

### æ¡ˆä¾‹2 äº‹ä»¶ä»£ç†

- ä¸ºæ¯ä¸ªliæ·»åŠ ç‚¹å‡»äº‹ä»¶

```html
<ul>
  <li>item 1</li>
  <li>item 2</li>
  <li>item 3</li>
  <li>item 4</li>
</ul>
```

```javascript
window.onload = () => {
  const ul = document.getElementsByTagName('ul')[0]
  ul.onclick = e => {
    const ev = e || window.event
    const target = ev.target || ev.srcElement
    if (target.nodeName.toLowerCase() === 'li') {
      console.log(target.innerHTML)
    }
  }
}
```

### é˜²æŠ– && èŠ‚æµ

> é˜²æŠ–ï¼šæœ¬è´¨æ˜¯çŸ­æ—¶é—´å†…é«˜é¢‘è§¦å‘ï¼ŒæŠŠçŸ­æ—¶é—´å†…çš„å¤šæ¬¡è¿ç»­è°ƒç”¨åˆå¹¶æˆä¸€æ¬¡ï¼Œåªè§¦å‘ä¸€æ¬¡å›è°ƒå‡½æ•°ï¼›
>
> èŠ‚æµï¼šå°†çŸ­æ—¶é—´çš„å‡½æ•°è°ƒç”¨ä»¥ä¸€ä¸ªå›ºå®šé¢‘ç‡é—´éš”æ‰§è¡Œã€‚

#### é˜²æŠ–

![img](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210419235636837.png)

â€‹		å®ç°

```javascript
const debounce = (func, wait = 500, immediate) => {
  let timeout
  return function() {
    // ä¸Šä¸‹æ–‡thiså¯¹è±¡
    const context = this
    const args = arguments
    // åˆ¤æ–­æ˜¯å¦ä¸ºç«‹å³æ‰§è¡Œ
    const callNow = immediate && !timeout
    timeout && clearTimeout(timeout)
    timeout = setTimeout(() => {
      timeout = null
      if (!immediate){
        func.apply(context, args)
      }
    }, wait)
    // ç«‹å³æ‰§è¡Œ
    if (callNow) {
      func.apply(context, args)
    }
  }
}
```

> ä½¿ç”¨setTimeoutåœ¨waitæ—¶é—´åæ‰§è¡Œäº‹ä»¶å›è°ƒï¼›
>
> å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…åˆæœ‰ç›¸å…³çš„äº‹ä»¶è§¦å‘ï¼Œåˆ™é€šè¿‡clearTimeout(timeout)å–æ¶ˆä¸Šä¸€æ¬¡è®¾ç½®çš„å›è°ƒï¼›
>
> åœ¨waitæ—¶é—´å†…æ²¡æœ‰è¿ç»­è§¦å‘å¤šæ¬¡äº‹ä»¶ï¼Œæ‰ä¼šçœŸæ­£è§¦å‘å›è°ƒå‡½æ•°ï¼›
>
> waitæ—¶é—´å†…å¤šæ¬¡è°ƒç”¨è¢«å½’å¹¶æˆäº†ä¸€æ¬¡ï¼Œåœ¨æœ€åä¸€æ¬¡æŠ–åŠ¨åï¼Œè¿›è¡Œå›è°ƒæ‰§è¡Œï¼›
>
> immediateç”¨äºç«‹å³æ‰§è¡Œå›è°ƒã€‚

```javascript
// é‡‡ç”¨é˜²æŠ–
window.addEventListener('scroll', debounce(() => {
	console.log('scroll')
}, 500))
```

#### èŠ‚æµ

![img](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210419235707038.png)

- ##### æ—¶é—´æˆ³å®ç°

```javascript
function throttleByTimestamp(fn, wait=500) {
  let previous = 0
  return function(...args) {
    const context = this
    let now = +new Date()
    if (now - previous > wait) {
      fn.apply(context, args)
      previous = now
    }
  }
}
```

- ##### å®šæ—¶å™¨å®ç°

```javascript
function throttleByTimeout(fn, wait=500) {
  let timeout
  return function(...args) {
    const context = this
    if (!timeout) {
      timeout = setTimeout(() => {
        fn.apply(context, args)
        timeout = null
      }, wait)
    }
  }
}
```

###### æ—¶é—´æˆ³å®ç° && å®šæ—¶å™¨å®ç°çš„åŒºåˆ«

- é¦–æ¬¡è§¦å‘
  - ä½¿ç”¨æ—¶é—´æˆ³ï¼šä¼šç«‹å³æ‰§è¡Œï¼ˆå°†previousè®¾ç½®ä¸º0çš„æƒ…å†µï¼‰
  - ä½¿ç”¨å®šæ—¶å™¨ï¼šä¼šè®¾ç½®å®šæ—¶å™¨ï¼Œwaitæ—¶é—´åæ‰§è¡Œ
- åœæ­¢è§¦å‘
  - ä½¿ç”¨æ—¶é—´æˆ³ï¼šåœæ­¢è§¦å‘åä¸å†æ‰§è¡Œ
  - ä½¿ç”¨å®šæ—¶å™¨ï¼šç”±äºå­˜åœ¨å®šæ—¶å™¨ï¼Œåœæ­¢è§¦å‘åè¿˜ä¼šæ‰§è¡Œä¸€æ¬¡

```javascript
body = document.body
body.onscroll = throttleByTimestamp(function(event) {
  console.log('scroll ä½¿ç”¨æ—¶é—´æˆ³èŠ‚æµ')
})
body.onscroll = throttleByTimeout(function(event) {
  console.log('scroll ä½¿ç”¨å®šæ—¶å™¨èŠ‚æµ')
})
```

### WebPå›¾ç‰‡ä¼˜åŒ–

### âš¡ **ä¸€ã€WebP æ ¸å¿ƒä¼˜åŠ¿**

| **æŒ‡æ ‡**       | WebP vs JPEG/PNG                                          | æ•ˆæœè¯´æ˜                   |
| :------------- | :-------------------------------------------------------- | :------------------------- |
| **ä½“ç§¯å‹ç¼©ç‡** | æ¯” JPEG å° **25-35%** æ¯” PNG å° **26%**                   | åŒç­‰ç”»è´¨ä¸‹æ˜¾è‘—å‡å°‘å¸¦å®½å ç”¨ |
| **æ”¯æŒç‰¹æ€§**   | âœ… æœ‰æŸ/æ— æŸå‹ç¼© âœ… é€æ˜åº¦ï¼ˆAlpha é€šé“ï¼‰ âœ… åŠ¨ç”»ï¼ˆç±»ä¼¼ GIFï¼‰ | å…¨é¢æ›¿ä»£ JPEG/PNG/GIF      |
| **è§£ç é€Ÿåº¦**   | æ¯” JPEG æ…¢ 1.5~2.2 å€ æ¯” PNG å¿« 1.5 å€                    | éœ€æƒè¡¡ä½“ç§¯èŠ‚çœä¸ CPU æ¶ˆè€—  |

> å®æµ‹æ¡ˆä¾‹ï¼šç”µå•†ç½‘ç«™é¦–å›¾ï¼ˆ1920x1080ï¼‰
>
> - JPEGï¼ˆ80%è´¨é‡ï¼‰ï¼š248 KB
> - WebPï¼ˆ80%è´¨é‡ï¼‰ï¼š**162 KB**ï¼ˆâ†“ **34.7%**ï¼‰

### ğŸ› ï¸ **äºŒã€è½¬æ¢å·¥å…·æ¨è**

#### 1. **å‘½ä»¤è¡Œå·¥å…·ï¼ˆé«˜æ•ˆæ‰¹é‡å¤„ç†ï¼‰**

- **cwebp**ï¼ˆå®˜æ–¹å·¥å…·ï¼‰ï¼š

  ```bash
  # å•æ–‡ä»¶è½¬æ¢ï¼ˆé»˜è®¤75%è´¨é‡ï¼‰
  cwebp input.jpg -o output.webp
  
  # æ‰¹é‡è½¬æ¢ï¼ˆç»“åˆ find å‘½ä»¤ï¼‰
  find ./images -name "*.jpg" -exec cwebp {} -o {}.webp \;
  ```

  **å…³é”®å‚æ•°**ï¼š
  `-q 80`ï¼šè´¨é‡ï¼ˆæ¨è 75-85 å¹³è¡¡ç”»è´¨/ä½“ç§¯ï¼‰
  `-m 6`ï¼šå‹ç¼©çº§åˆ«ï¼ˆ0-6ï¼Œè¶Šé«˜è¶Šæ…¢ï¼‰
  `-lossless`ï¼šæ— æŸæ¨¡å¼ï¼ˆé€‚åˆå›¾æ ‡/çº¿ç¨¿ï¼‰

- **imagemin-webp**ï¼ˆNode.js é›†æˆï¼‰ï¼š

  ```js
  const imagemin = require('imagemin');
  const imageminWebp = require('imagemin-webp');
  
  (async () => {
    await imagemin(['images/*.{jpg,png}'], {
      destination: 'webp_images',
      plugins: [imageminWebp({ quality: 75 })]
    });
  })();
  ```

#### 2. **å›¾å½¢ç•Œé¢å·¥å…·**

- **Squoosh**ï¼ˆGoogle å¼€æºï¼‰ï¼š[https://squoosh.app](https://squoosh.app/)
  - å®æ—¶é¢„è§ˆç”»è´¨å¯¹æ¯”
  - æ”¯æŒé«˜çº§å‚æ•°ï¼ˆè‰²åŸŸã€é™å™ªï¼‰

### ğŸŒ **ä¸‰ã€å‰ç«¯éƒ¨ç½²ç­–ç•¥**

#### 1. **å…¼å®¹æ€§å…œåº•æ–¹æ¡ˆï¼ˆ`<picture>`æ ‡ç­¾ï¼‰

```html
<picture>
  <!-- ä¼˜å…ˆåŠ è½½ WebPï¼ˆæ”¯æŒæµè§ˆå™¨ï¼‰ -->
  <source srcset="image.webp" type="image/webp">
  <!-- å›é€€åˆ°åŸæ ¼å¼ -->
  <img src="image.jpg" alt="Description" loading="lazy">
</picture>
```

#### 2. **CDN åŠ¨æ€é€‚é…**

- **Cloudflare Polish**ï¼šè‡ªåŠ¨è½¬æ¢ JPG/PNG â†’ WebPï¼ˆæ”¯æŒç¼“å­˜ï¼‰

- **Akamai Image Manager**ï¼šæŒ‰è®¾å¤‡ç±»å‹åŠ¨æ€è¾“å‡º WebP

  

> é¡¹ç›®ä¸­å¾€å¾€å­˜åœ¨å¤§é‡çš„å›¾ç‰‡å†…å®¹ï¼Œå› æ­¤å›¾ç‰‡çš„æ€§èƒ½ä¼˜åŒ–æ˜¯ç“¶é¢ˆå’Œé‡ç‚¹ï¼›
>
> é™¤äº†ä¼ ç»Ÿçš„å›¾ç‰‡æ‡’åŠ è½½å¤–ï¼›
>
> è¿˜å¯ä»¥ä½¿ç”¨WebPå›¾ç‰‡æ ¼å¼çš„æ›¿æ¢ï¼›
>
> æ½œåœ¨å…¼å®¹æ€§çš„é—®é¢˜ï¼Œéœ€è¦å…ˆå¯¹å…¼å®¹æ€§è¿›è¡Œå—…æ¢ï¼›

- å…¼å®¹æ€§ä»£ç ç‰‡æ®µ

```javascript
const supportWebP = () => new Promise(resolve => {
  const image = new Image()
  image.onerror = () => resolve(false)
  image.onload = () => resolve(image.width === 1)
  // è¯¥èµ„æºæ˜¯ä¸€å¼ åƒç´ ä¸º1x1çš„WebPæ ¼å¼å›¾ç‰‡
  image.src = 'data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA='
}).catch(() => false)

supportWebP().then((isSupport) => {
  console.log(isSupport)
})

// true
```

### **AVIF**

### âš¡ **ä¸€ã€AVIF æ ¸å¿ƒä¼˜åŠ¿ï¼ˆå¯¹æ¯” WebP/JPEGï¼‰**

| **æŒ‡æ ‡**     | AVIF è¡¨ç°                                                    | å¯¹æ ‡æ ¼å¼å·®è·             |
| :----------- | :----------------------------------------------------------- | :----------------------- |
| **å‹ç¼©æ•ˆç‡** | æ¯” JPEG å° **50%+** æ¯” WebP å° **20-30%**                    | åŒç­‰ç”»è´¨ä¸‹å…¨çƒæœ€å¼ºå‹ç¼©ç‡ |
| **åŠŸèƒ½æ”¯æŒ** | âœ… HDRï¼ˆ10/12bit è‰²æ·±ï¼‰ âœ… å¹¿è‰²åŸŸï¼ˆBT.2020ï¼‰ âœ… æ— æŸ/æœ‰æŸ/æ¸è¿›å¼ âœ… æ·±åº¦å›¾/å›¾å±‚ | è¶…è¶Š WebP çš„ä¸“ä¸šçº§ç‰¹æ€§   |
| **ç”»è´¨ä¿ç•™** | ä½ç ç‡ä¸‹ç»†èŠ‚æŸå¤±æ›´å°‘ ï¼ˆå°¤å…¶çº¹ç†/æ¸å˜åŒºåŸŸï¼‰                   | ä¸»è§‚ç”»è´¨è¯„åˆ†é«˜ 30%+      |

> **å®æµ‹æ•°æ®**ï¼ˆ4K é£æ™¯å›¾ï¼ŒSSIM 0.98ï¼‰ï¼š
>
> - JPEGï¼š12.8 MB
> - WebPï¼š7.1 MB
> - **AVIFï¼š4.9 MB**ï¼ˆâ†“ 61% vs JPEG, â†“ 31% vs WebPï¼‰

### ğŸ› ï¸ **äºŒã€ç¼–ç /è§£ç å·¥å…·é“¾**

#### 1. **å‘½ä»¤è¡Œå·¥å…·**

- **libavif**ï¼ˆå®˜æ–¹ç¼–ç å™¨ï¼‰ï¼š

  ```bash
  # å®‰è£…
  git clone https://github.com/AOMediaCodec/libavif.git
  cd libavif && mkdir build && cd build
  cmake .. && make
  
  # è½¬æ¢å›¾ç‰‡ï¼ˆæœ‰æŸå‹ç¼©ï¼‰
  avifenc -c aom -s 6 -q 35 input.jpg output.avif
  ```

  **å…³é”®å‚æ•°**ï¼š
  `-q 1-100`ï¼šè´¨é‡ï¼ˆå€¼è¶Šé«˜ç”»è´¨è¶Šå¥½ï¼Œæ¨è 30-50ï¼‰
  `-s 0-10`ï¼šé€Ÿåº¦ï¼ˆ0 æœ€æ…¢å‹ç¼©ç‡æœ€é«˜ï¼‰
  `--min 0 --max 63`ï¼šè®¾ç½®é‡åŒ–å™¨èŒƒå›´ï¼ˆç²¾ç»†æ§åˆ¶ï¼‰

- **FFmpeg**ï¼ˆè§†é¢‘å¸§è½¬ AVIFï¼‰ï¼š

  ```
  ffmpeg -i frame.png -c:v libaom-av1 -still-picture 1 frame.avif
  ```

#### 2. **å‰ç«¯å·¥ç¨‹åŒ–é›†æˆ**

- **Sharp**ï¼ˆNode.js é«˜æ€§èƒ½å›¾åƒå¤„ç†ï¼‰ï¼š

  ```js
  const sharp = require('sharp');
  
  sharp('input.png')
    .avif({ 
      quality: 45,      // è´¨é‡ (1-100)
      effort: 6,        // å‹ç¼©åŠªåŠ›å€¼ (0-9, è¶Šé«˜è¶Šæ…¢)
      chromaSubsampling: '4:4:4' // è‰²åº¦é‡‡æ ·ï¼ˆé¿å…è‰²å¸¦ï¼‰
    })
    .toFile('output.avif');
  ```

- **Vite æ’ä»¶**ï¼ˆæ„å»ºæ—¶è‡ªåŠ¨è½¬æ¢ï¼‰ï¼š

  ```bash
  // vite.config.js
  import { defineConfig } from 'vite';
  import avif from 'vite-plugin-avif';
  
  export default defineConfig({
    plugins: [avif({ quality: 50 })]
  });
  ```

------

### ğŸŒ **ä¸‰ã€å‰ç«¯éƒ¨ç½²ç­–ç•¥**

#### 1. å…¼å®¹æ€§å…œåº•æ–¹æ¡ˆ

```html
<picture>
  <!-- ä¼˜å…ˆ AVIFï¼ˆç°ä»£æµè§ˆå™¨ï¼‰ -->
  <source srcset="image.avif" type="image/avif">
  <!-- æ¬¡é€‰ WebP -->
  <source srcset="image.webp" type="image/webp">
  <!-- æœ€ç»ˆå›é€€ -->
  <img src="image.jpg" alt="æè¿°" loading="lazy" decoding="async">
</picture>
```

#### 2. **CDN åŠ¨æ€é€‚é…**

- **Cloudflare Images**ï¼šæ”¯æŒæŒ‰éœ€è¾“å‡º AVIFï¼ˆéœ€å¯ç”¨ Polish é«˜çº§ç‰ˆï¼‰
- **Akamai Media Accelerator**ï¼šå®æ—¶è½¬ç  + AVIF åˆ†å‘
- **Fastly Image Optimizer**ï¼šé€šè¿‡ `?format=avif` å‚æ•°åŠ¨æ€è½¬æ¢

#### 3. Nginx å†…å®¹åå•†

```nginx
map $http_accept $avif_suffix {
  default   "";
  "~*avif"  ".avif";
}

server {
  location ~* \.(jpg|png|webp)$ {
    add_header Vary Accept;
    try_files $uri$avif_suffix $uri =404;
  }
}
```

------

### âš ï¸ **å››ã€å…³é”®æ³¨æ„äº‹é¡¹**

1. **è§£ç æ€§èƒ½ç“¶é¢ˆ**

   - è§£ç é€Ÿåº¦æ¯” JPEG æ…¢ **3-5 å€**ï¼ˆä½ç«¯ç§»åŠ¨è®¾å¤‡æ…ç”¨ï¼‰

   - è§£å†³æ–¹æ¡ˆï¼š

     ```html
     <!-- ä»…å¯¹é«˜åˆ†è¾¨ç‡å›¾ç‰‡ä½¿ç”¨ AVIF -->
     <source 
       media="(min-width: 1200px)" 
       srcset="large.avif" 
       type="image/avif"
     >
     ```

2. **å…¼å®¹æ€§ç°çŠ¶**ï¼ˆæˆªè‡³ 2025ï¼‰

   | **æµè§ˆå™¨**     | æ”¯æŒç‰ˆæœ¬        | è¦†ç›–ç‡ |
   | :------------- | :-------------- | :----- |
   | Chrome         | 85+             | 92%    |
   | Firefox        | 86+             | 88%    |
   | Safari         | 16.4+           | 75%    |
   | Edge           | 90+             | 91%    |
   | **ä¸æ”¯æŒç¯å¢ƒ** | IE11ã€iOS <16.4 | <8%    |

3. **å‹ç¼©å‚æ•°é»„é‡‘ç»„åˆ**

   - é«˜ç”»è´¨ï¼š`quality=50, effort=6`
   - å¿«é€Ÿç¼–ç ï¼š`quality=40, effort=4`
   - æ— æŸæ¨¡å¼ï¼š`quality=100, effort=9`

------

### ğŸ“Š **äº”ã€æ€§èƒ½æ”¶ç›Šå®æµ‹**

| **åœºæ™¯**    | æ ¼å¼     | ä½“ç§¯      | LCP      | FID      | ç»¼åˆæ”¶ç›Š  |
| :---------- | :------- | :-------- | :------- | :------- | :-------- |
| ç”µå•† Banner | JPEG     | 420KB     | 1.8s     | 68ms     | åŸºå‡†      |
| (1920Ã—1080) | WebP     | 280KB     | 1.5s     | 52ms     | â†‘ 17%     |
|             | **AVIF** | **180KB** | **1.2s** | **38ms** | â†‘ **34%** |
| ç”¨æˆ·å¤´åƒ    | PNG      | 120KB     | -        | -        | åŸºå‡†      |
| (200Ã—200)   | WebP     | 32KB      | -        | -        | â†“ 73%     |
|             | **AVIF** | **18KB**  | -        | -        | â†“ **85%** |

> æ•°æ®æ¥æºï¼š[Web Almanac 2025 å›¾ç‰‡æ€§èƒ½æŠ¥å‘Š](https://almanac.httparchive.org/)

------

### ğŸ’ **æ€»ç»“ï¼šAVIF è½åœ°ç­–ç•¥**

1. **é€‚ç”¨åœºæ™¯ä¼˜å…ˆçº§**ï¼š
   - âœ… **å¤§å°ºå¯¸å›¾ç‰‡**ï¼ˆBanner/äº§å“å›¾/èƒŒæ™¯å›¾ï¼‰
   - âœ… **é™æ€èµ„æº**ï¼ˆå›¾æ ‡/æ’ç”»éœ€é…åˆ SVGï¼‰
   - âš ï¸ **å°å°ºå¯¸åŠ¨æ€å›¾**ï¼ˆç”¨ WebP æ›´å¹³è¡¡æ€§èƒ½ï¼‰
2. **å·¥å…·é“¾æ¨è**ï¼š
   - å¼€å‘ç¯å¢ƒï¼š`sharp` + `vite-plugin-avif`
   - ç”Ÿäº§ç¯å¢ƒï¼šCDN åŠ¨æ€è½¬æ¢ï¼ˆCloudflare/Akamaiï¼‰



# ğŸ“Œ å‰ç«¯æ€§èƒ½ä¼˜åŒ–é€ŸæŸ¥è¡¨

## ä¸€ã€é¡µé¢å·¥ç¨‹ä¼˜åŒ–

| ä¼˜åŒ–æ–¹å‘     | æ–¹æ³•/æ–¹æ¡ˆ                     | å…³é”®ç‚¹/ä»£ç ç‰‡æ®µ                               |
| ------------ | ----------------------------- | --------------------------------------------- |
| **ç½‘ç»œåè®®** | HTTP/2 / HTTP/3               | å¤šè·¯å¤ç”¨ã€å¤´éƒ¨å‹ç¼©ã€0-RTT                     |
| **å‹ç¼©**     | Gzip / Brotli                 | Nginx/webpack é…ç½® `compression`              |
| **CDN**      | é™æ€èµ„æºåˆ†å‘                  | ç¼“å­˜ + è¾¹ç¼˜èŠ‚ç‚¹åŠ é€Ÿ                           |
| **ç¼“å­˜**     | Cache-Control / ETag          | ç‰ˆæœ¬å· + hash ç¼“å­˜                            |
| **é¢„åŠ è½½**   | preload / prefetch            | `<link rel="preload" as="script" href="...">` |
| **ä»£ç ä¼˜åŒ–** | Tree Shaking / Code Splitting | webpackã€Vite åŠ¨æ€ import                     |

------

## äºŒã€ä»£ç ç»†èŠ‚ä¼˜åŒ–

| åœºæ™¯         | é—®é¢˜                    | ä¼˜åŒ–æ–¹æ¡ˆ                           | ç¤ºä¾‹ä»£ç                                                      |
| ------------ | ----------------------- | ---------------------------------- | ------------------------------------------------------------ |
| **DOM æ“ä½œ** | å¸ƒå±€æŠ–åŠ¨ (å¼ºåˆ¶åŒæ­¥å¸ƒå±€) | æ‰¹é‡å†™/è¯»ã€`requestAnimationFrame` | `js<br>const h = el.clientHeight;<br>requestAnimationFrame(()=> el.style.height = h*2 + 'px');` |
| **äº‹ä»¶ç»‘å®š** | ä¸ºæ¯ä¸ªå…ƒç´ ç»‘å®šäº‹ä»¶      | **äº‹ä»¶å§”æ‰˜**                       | `js<br>ul.onclick = e => { if(e.target.tagName==='LI'){...}}` |
| **é«˜é¢‘è§¦å‘** | scrollã€resize          | **é˜²æŠ– / èŠ‚æµ**                    | `js<br>// é˜²æŠ–<br>const debounce=(fn,wait)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),wait)}}<br>// èŠ‚æµ<br>const throttle=(fn,wait)=>{let prev=0;return(...a)=>{let now=Date.now();if(now-prev>wait){fn(...a);prev=now}}}` |

------

## ä¸‰ã€åŠ¨ç”»ä¼˜åŒ–

| æŠ€æœ¯           | åŸåˆ™                                           | ä»£ç /æŠ€å·§                                                    |
| -------------- | ---------------------------------------------- | ------------------------------------------------------------ |
| **CSS3 åŠ¨ç”»**  | ä¼˜å…ˆä½¿ç”¨ GPU åŠ é€Ÿå±æ€§ (`transform`, `opacity`) | `transform: translateZ(0);`                                  |
| **ç‹¬ç«‹åˆæˆå±‚** | å‡å°‘é‡ç»˜é‡æ’                                   | `will-change: transform, opacity;`                           |
| **JS åŠ¨ç”»**    | ç”¨ `requestAnimationFrame` æ›¿ä»£ `setInterval`  | `js<br>function step(){/*æ›´æ–°åŠ¨ç”»*/ requestAnimationFrame(step)} step()` |

------

## å››ã€å›¾ç‰‡ä¸å¤šåª’ä½“ä¼˜åŒ–

| æ ¼å¼           | ä¼˜åŠ¿                            | ä½¿ç”¨æ–¹å¼                                                     |
| -------------- | ------------------------------- | ------------------------------------------------------------ |
| **WebP**       | æ¯” JPEG å° 25-35%               | `html<br><picture><source srcset="img.webp" type="image/webp"><img src="img.jpg"></picture>` |
| **AVIF**       | æ¯” WebP å†å° 20-30%ï¼ˆæ”¯æŒ HDRï¼‰ | `<source srcset="img.avif" type="image/avif">`               |
| **æ‡’åŠ è½½**     | å»¶è¿ŸåŠ è½½éé¦–å±å›¾                | `<img src="a.jpg" loading="lazy">`                           |
| **å“åº”å¼å›¾ç‰‡** | æ ¹æ®è®¾å¤‡åŠ è½½ä¸åŒåˆ†è¾¨ç‡          | `<img srcset="small.jpg 480w, large.jpg 1080w" sizes="(max-width:600px) 480px, 1080px" src="large.jpg">` |

------

## äº”ã€è¿›é˜¶ä¼˜åŒ–

| åœºæ™¯           | æ–¹æ¡ˆ                     | å…³é”®ç‚¹                     |
| -------------- | ------------------------ | -------------------------- |
| **é¦–å±ä¼˜åŒ–**   | Critical CSS / SSR / SSG | å†…è”å…³é”® CSSï¼Œéª¨æ¶å±       |
| **ç¦»çº¿ä½“éªŒ**   | Service Worker / PWA     | ç¼“å­˜èµ„æºï¼Œæ”¯æŒæ–­ç½‘è®¿é—®     |
| **å¤§è®¡ç®—ä»»åŠ¡** | Web Worker               | å°†è®¡ç®—ç§»å‡ºä¸»çº¿ç¨‹           |
| **é•¿ä»»åŠ¡ä¼˜åŒ–** | requestIdleCallback      | æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œéå…³é”®é€»è¾‘ |
| **ç›‘æ§æŒ‡æ ‡**   | LCP / FID / CLS          | æ ¸å¿ƒ Web Vitals æŒ‡æ ‡       |

------

âœ… **ä¼˜å…ˆçº§è½åœ°å»ºè®®**

1. **å›¾ç‰‡ä¼˜åŒ–**ï¼ˆWebP/AVIF + æ‡’åŠ è½½ï¼‰
2. **ç¼“å­˜ + ä»£ç æ‹†åˆ†**ï¼ˆå‡å°‘é¦–å±è¯·æ±‚ï¼‰
3. **åŠ¨ç”»/äº¤äº’ä¼˜åŒ–**ï¼ˆæµç•…åº¦æå‡ï¼‰
4. **ç›‘æ§ & æŒç»­ä¼˜åŒ–**ï¼ˆLighthouse / Sentryï¼‰
