### **一、HTTP协议演进对比表**

| **特性**         | **HTTP/1.1**     | **HTTP/2**             | **HTTP/3**               | **HTTPS**           |
| :--------------- | :--------------- | :--------------------- | :----------------------- | :------------------ |
| **传输协议**     | TCP（明文）      | TCP + TLS              | QUIC（基于UDP）          | HTTP + TLS/SSL      |
| **多路复用**     | ❌ 需多个TCP连接  | ✅ 单连接多流（帧机制） | ✅ 流级隔离（丢包无阻塞） | 同HTTP/1.1/2        |
| **队头阻塞问题** | 连接级阻塞       | TCP层阻塞              | ✅ 完全解决               | 同HTTP/1.1/2        |
| **加密机制**     | ❌ 明文传输       | ✅ 强制TLS（主流实现）  | ✅ 内建TLS 1.3            | ✅ TLS/SSL加密       |
| **握手延迟**     | 1 RTT（TCP握手） | 2-3 RTT（TCP+TLS）     | ✅ 0-1 RTT                | 2-3 RTT（TCP+TLS）  |
| **头部压缩**     | ❌                | ✅ HPACK                | ✅ QPACK（优化流独立）    | 无独立压缩          |
| **连接迁移能力** | ❌                | ❌                      | ✅ 网络切换无感（连接ID） | ❌                   |
| **服务器推送**   | ❌                | ✅ 主动推送关联资源     | ✅ 类似HTTP/2             | 依赖HTTP版本        |
| **典型应用场景** | 静态资源服务     | 动态网页/API           | 高丢包网络（5G/移动）    | 登录/支付等安全传输 |
| **部署复杂度**   | ★☆☆☆☆            | ★★★☆☆（需ALPN支持）    | ★★★★☆（需UDP支持）       | ★★★☆☆（需证书管理） |

------

**核心概念**：

- HTTP/2 解决了多路复用与头部压缩，但受 TCP 队头阻塞影响。
- HTTP/3 基于 UDP，完全解决队头阻塞和连接迁移问题。
- HTTPS 在HTTP基础上增加TLS/SSL加密，确保机密性和完整性。

### **二、对称加密 vs 非对称加密对比表**

| **特性**         | **对称加密**                                                 | **非对称加密**                                               |
| :--------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| **密钥机制**     | 单一密钥（加解密相同）                                       | 密钥对（公钥加密，私钥解密）                                 |
| **算法代表**     | AES-256                                                      | RSA-2048                                                     |
| **处理速度**     | ⚡ 极快（1GB/s+）                                             | ⚠️ 慢（RSA签名比AES慢1000倍）                                 |
| **密钥长度**     | 128/256位                                                    | 2048位（RSA）=112位安全强度                                  |
| **安全基础**     | 算法复杂度                                                   | 数学难题（大数分解/离散对数）                                |
| **主要用途**     | 大数据加密（会话数据）                                       | 密钥交换/数字签名                                            |
| **核心风险**     | 1. 密钥分发截获                                              | 1. 加解密速度慢<br />2. 秘钥长度大<br />3. 公钥被拦截或私钥泄露 |
| **混合加密实践** | ✅ TLS数据传输阶段                                            | ✅ TLS握手阶段（ECDHE密钥交换）                               |
| **密钥生成**     | 使用安全随机数生成器创建密钥（如AES-256密钥为256位随机数）   | ECDHE + 前向安全                                             |
|                  | <img src="C:\Users\ZSY\AppData\Roaming\Typora\typora-user-images\image-20250815214336958.png" alt="image-20250815214336958" style="zoom: 67%;" /> | <img src="C:\Users\ZSY\AppData\Roaming\Typora\typora-user-images\image-20250815214408342.png" alt="image-20250815214408342" style="zoom:67%;" /> |

混合加密

- 通过**非对称加密建立安全通道**交换密钥，再用**对称加密保护实际数据传输**，实现了安全性与性能的最佳平衡

<img src="C:\Users\ZSY\AppData\Roaming\Typora\typora-user-images\image-20250815214918284.png" alt="image-20250815214918284" style="zoom:80%;" />

------

### **三、HTTPS证书验证流程表**

| **验证步骤**     | **验证内容**         | **技术细节**                                                 |
| :--------------- | :------------------- | :----------------------------------------------------------- |
| **证书链完整性** | 信任链构建           | 站点证书 → 中级CA → 根CA（预置在操作系统）                   |
| **有效期检查**   | 起止时间验证         | `Not Before` 和 `Not After` 字段比对系统时间                 |
| **域名匹配**     | 主体名称验证         | 检查`Subject Alternative Name (SAN)` 或 `Common Name (CN)`   |
| **吊销状态检查** | 证书是否失效         | 1. CRL（证书吊销列表） 2. OCSP（在线状态协议） 3. OCSP Stapling（优化） |
| **密钥用途**     | 证书授权范围         | 验证`Extended Key Usage`包含`serverAuth`                     |
| **签名算法**     | 加密强度验证         | 拒绝SHA-1，要求SHA-256/RSA或ECDSA                            |
| **物理防伪**     | 实体证书验证（可选） | 1. 二维码扫描（跳转gov.cn） 2. 紫外荧光/安全线识别           |

**核心作用**：

- 身份验证
- 数据加密
- 数据完整性（防篡改）

### **四、HTTP缓存机制详解表**

#### 1. 缓存类型对比

| **缓存策略** | **响应头**                    | **请求头**          | **工作原理**                   | **适用场景**            |
| :----------- | :---------------------------- | :------------------ | :----------------------------- | :---------------------- |
| **强缓存**   | `Cache-Control: max-age=3600` | 无                  | 直接使用本地副本，不请求服务器 | 静态资源（JS/CSS/图片） |
|              | `Expires: <GMT时间>`          |                     |                                |                         |
| **协商缓存** | `ETag: "5f3b2a1e"`            | `If-None-Match`     | 发送标识验证资源是否修改       | 频繁更新的小文件        |
|              | `Last-Modified: <GMT时间>`    | `If-Modified-Since` | 发送时间戳验证                 |                         |
| **禁止缓存** | `Cache-Control: no-store`     | 无                  | 始终从服务器获取最新资源       | 敏感数据（银行页面）    |
| **条件缓存** | `Cache-Control: no-cache`     | `If-None-Match`     | 每次使用前必须验证有效性       | 动态HTML/API响应        |

#### 2. 缓存优化技巧

| **优化技术**       | **实现方式**           | **优势**            | **示例**                                            |
| :----------------- | :--------------------- | :------------------ | :-------------------------------------------------- |
| **内容指纹**       | 文件名嵌入哈希值       | 强缓存安全更新      | `app.5f3b2a1e.js`                                   |
| **分层缓存控制**   | 区分客户端和代理缓存   | 精细控制缓存层级    | `Cache-Control: public, s-maxage=3600, max-age=600` |
| **Service Worker** | 拦截请求实现编程式缓存 | 离线可用/细粒度控制 | `cache.put(event.request, response.clone())`        |
| **Vary响应头**     | 根据请求头缓存不同版本 | 适配多设备类型      | `Vary: User-Agent`                                  |
| **CDN边缘缓存**    | 配置CDN缓存规则        | 减少源站压力        | Cloudflare规则：`Cache Level: Cache Everything`     |

#### 3. 缓存性能影响

| **策略**       | 首次加载时间 | 缓存命中加载 | 带宽消耗 | 服务器负载 |
| :------------- | :----------- | :----------- | :------- | :--------- |
| 无缓存         | 100%         | 100%         | 100%     | 100%       |
| 强缓存         | 100%         | <5%          | 100%     | <1%        |
| 协商缓存       | 100%         | 20-40%       | 60-80%   | 10-30%     |
| Service Worker | 120%         | <3%          | 50-70%   | <0.5%      |

### http & https

- #### 区别
  
  - http
    - http通常承载与TCP上 ；
    - 默认端口号：80
    - 使用tcp三次握手建立连接，客户端和服务器需要交换3个包
  - https
    - https就是在http和TCP之间，添加一个安全协议层SSL(Secure Socket Layer)/TLS(Transport Layer Security)；
    - 默认端口号：443
    - 除了tcp三次握手，还有ssl握手的9个包
  
- #### 为什么https更安全
  在网络请求中需要有很多服务器，路由器的转发其中的节点都可能篡改信息；
  使用https，秘钥只有在终点站才有；
  https之所以http安全，是因为利用SSL/TLS协议传输；
  它包含证书、卸载、流量转发、负载均衡、页面适配、浏览器适配、refer传递等技术保障了传输过程的安全性；
  
- #### https证书
  - 是什么
  
    **HTTPS证书**（正式名称为TLS/SSL证书）是一种数字文件，用于在客户端（浏览器）与服务器之间建立**加密连接**和**身份认证**。它由受信任的第三方机构（**证书颁发机构，CA**）签发，是HTTPS协议的核心安全组件
  
    ```mermaid
    graph LR
        A[网站服务器] -->|申请| B[证书颁发机构CA]
        B -->|验证身份| A
        B -->|签发证书| A
        A -->|部署证书| C[用户浏览器]
        C -->|加密通信| A
    ```
  
  - 如何验证证书
  
    ```mermaid
    graph TD
        A[浏览器接收证书] --> B[证书链验证]
        B --> C[签名有效性验证]
        C --> D[有效期检查]
        D --> E[域名匹配]
        E --> F[吊销状态检查]
        F --> G[扩展属性验证]
        G --> H[验证通过]
    ```
  
    
  
  - 作用
  
    - 身份验证
  
      | **验证类型** | **机制说明**                                 | **安全价值**         |
      | :----------- | :------------------------------------------- | :------------------- |
      | 域名所有权   | 验证申请者是否控制该域名（DNS解析/文件验证） | 防止钓鱼网站         |
      | 组织真实性   | 企业证书（OV/EV）需验证工商注册信息          | 显示公司名称增强信任 |
      | 证书链信任   | 由根证书→中级CA→站点证书构建信任链           | 防止伪造证书         |
  
      ```mermaid
      sequenceDiagram
        客户端->>CA: 证书申请(CSR)
        CA->>客户端: 签发证书
        客户端->>服务器: HTTPS连接
        服务器->>客户端: 发送证书链
        客户端->>OCSP: 查询吊销状态
        客户端->>CT日志: 验证证书透明度
        alt 验证通过
          客户端->>服务器: 建立加密通道
        else 验证失败
          客户端->>用户: 显示警告
        end
      ```
  
    - 数据加密
  
      | **技术**   | **实现方式**             | **防御攻击** |
      | :--------- | :----------------------- | :----------- |
      | HMAC       | 哈希消息认证码           | 数据篡改     |
      | 数字签名   | 用CA私钥签名证书内容     | 证书伪造     |
      | 证书透明度 | 所有证书公开记录到CT日志 | 非法签发证书 |
  
      ```mermaid
      sequenceDiagram
          客户端->>服务器: ClientHello (支持算法列表)
          服务器->>客户端: ServerHello (证书+公钥)
          客户端->>服务器: 生成会话密钥(用公钥加密)
          服务器->>客户端: 确认加密通道建立
          客户端->>服务器: 加密业务数据
      ```
  
    - 数据完整性（防篡改）
  
      | **技术**   | **实现方式**             | **防御攻击** |
      | :--------- | :----------------------- | :----------- |
      | HMAC       | 哈希消息认证码           | 数据篡改     |
      | 数字签名   | 用CA私钥签名证书内容     | 证书伪造     |
      | 证书透明度 | 所有证书公开记录到CT日志 | 非法签发证书 |
  
- #### http/2的了解
  http/2引入了’服务端推送‘（server push）的概念；
  它允许服务器端在客户端需要数据之前，主动将数据发送到客户端缓存中，从而提高性能；
  提供更多的加密支持；
  使用多路技术，允许多个消息在一个连接上同时交差；
  增加了头压缩（header compression），请求非常小；
  
- #### 完整的http事务流程
  
  - 域名解析
  - 发起tcp3次握手
  - 建立tcp连接后发起http请求
  - 服务器端响应http请求，浏览器得到HTML代码
  - 浏览器解析HTML代码，并请求代码中的资源
  - 浏览器对页面进行渲染并呈现给用户
  
- #### 什么是http无状态协议？如何克服无状态协议的缺陷？
  无状态协议对于事务处理没有记忆能力，
  缺少状态，如果后续需要处理，需要之前提供的信息，
  方法：通过cookie和会话保存信息；
  
- #### http有什么缺点
  
  - 通信使用明文不加密，内容可能被窃听、篡改；
  
- #### http1.1新特性
  默认持久连接，节省通信量；
  只要客户、服务端 任意一端没有明确指出断开tcp连接，就一直保持连接可以多次发送http请求；
  客户端可以同时发起多个http请求，无需一个个等待响应断点续传原理；
  
- #### 什么是反向代理（reverse proxy）
  指通过代理服务器来接收互联网上的连接请求，
  然后将请求转发给内部网络上的服务器；
  并把从服务器上得到的结果返回给互联网上；
  请求连接客户端，此时代理服务器，对外就表现为一个反向代理服务器；
  
- #### 状态码
  
  - 200：OK，请求成功在服务器被正常处理
  - 204：No Content，请求成功，但没有资源可返回
  - 206：Partial Content，对资源某一部分请求
  - 301：Moved Permanently，永久性重定向
  - 302：Found，临时重定向
  - 304：Not Modified，资源已找到，但未符合条件请求
  - 400： Bad Request，请求报文存在语法错误
  - 401：Unauthorized，未认证
  - 403：ForBidden，禁止访问
  - 404：Not Found，无法找到资源
  - 405：Method Not Allowed，服务器禁止使用该方法请求
  - 500：Internal Server Error，服务器异常
  - 502：Bad Gateway，网关或代理服务器报错
  - 503：Service Unavailable，服务器暂时处于超负载或进行停机维护

### TCP

- #### 三次握手
  ![](https://i-coder.oss-cn-beijing.aliyuncs.com/files/20220407220025.png)
  
  - Client → Server: SYN 包（同步序列号）：变成SYN-SENT状态；（请求建立连接）
  - Server → Client: SYN-ACK 包：变成SYN-REVD；（确认请求）
  - Client → Server: ACK 包 → ESTABLISHED：变成ESTABLISHED状态；（确认收到，连接成功）
- #### 四次挥手
  ![](https://i-coder.oss-cn-beijing.aliyuncs.com/files/20220407221529.png)
  
  - 双方处于ESTABLISHED状态；
  - Client → Server: FIN；（数据发送完了，请求关闭连接（**主动关闭方**））
  - Server → Client: ACK；（收到，服务器可能还有数据要发送，所以连接还没完全关闭）
  - Server → Client: FIN；（服务器数据发送完，发送 FIN 包给客户端（被动关闭方））
  - Client → Server: ACK → CLOSE；（客户端进入 **TIME-WAIT** 状态（等待可能的重传 FIN），然后完全关闭连接）