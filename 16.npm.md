### rslib

### npm & pnpm & yarn

### **ğŸ”§æ ¸å¿ƒæœºåˆ¶å·®å¼‚**

| **ç‰¹æ€§**     | **npm**                            | **Yarn**                             | **pnpm**                                            |
| :----------- | :--------------------------------- | :----------------------------------- | :-------------------------------------------------- |
| **ä¾èµ–ç®¡ç†** | æ‰å¹³åŒ–ç»“æ„ï¼ˆå¯èƒ½é‡å¤ä¾èµ–ï¼‰         | æ‰å¹³åŒ– + ç¡®å®šæ€§é”æ–‡ä»¶ï¼ˆ`yarn.lock`ï¼‰ | **ç¡¬é“¾æ¥ + ç¬¦å·é“¾æ¥**ï¼ˆå…¨å±€å­˜å‚¨å¤ç”¨ï¼‰               |
| **é”æ–‡ä»¶**   | `package-lock.json`ï¼ˆJSON æ ¼å¼ï¼‰   | `yarn.lock`ï¼ˆç´§å‡‘æ–‡æœ¬æ ¼å¼ï¼‰          | `pnpm-lock.yaml`ï¼ˆYAML + å“ˆå¸Œæ ¡éªŒï¼‰                 |
| **ä¾èµ–éš”ç¦»** | âŒ å­˜åœ¨â€œå¹½çµä¾èµ–â€ï¼ˆæœªå£°æ˜åŒ…å¯è®¿é—®ï¼‰ | âŒ åŒ npm çš„å¹½çµä¾èµ–é—®é¢˜              | âœ… **ä¸¥æ ¼éš”ç¦»**ï¼ˆä»…è®¿é—®æ˜¾å¼å£°æ˜çš„ä¾èµ–ï¼‰              |
| **å­˜å‚¨æ–¹å¼** | æ¯ä¸ªé¡¹ç›®ç‹¬ç«‹å¤åˆ¶ä¾èµ–               | æ¯ä¸ªé¡¹ç›®ç‹¬ç«‹å¤åˆ¶ä¾èµ–                 | **å…¨å±€å­˜å‚¨**ï¼ˆ`~/.pnpm-store`ï¼‰ï¼Œé¡¹ç›®é€šè¿‡ç¡¬é“¾æ¥å¼•ç”¨ |

**pnpm ç¡¬é“¾æ¥ç¤ºä¾‹**ï¼š
è‹¥ 100 ä¸ªé¡¹ç›®ä¾èµ–ç›¸åŒ `lodash` ç‰ˆæœ¬ï¼Œç£ç›˜ä»…å­˜ä¸€ä»½ä»£ç ï¼Œé¡¹ç›®é€šè¿‡ç¡¬é“¾æ¥å¤ç”¨ï¼ŒèŠ‚çœ 60-80% ç©ºé—´

### **âš¡æ€§èƒ½å¯¹æ¯”**

| **æŒ‡æ ‡**               | **npm**        | **Yarn**           | **pnpm**                     |
| :--------------------- | :------------- | :----------------- | :--------------------------- |
| **å®‰è£…é€Ÿåº¦**ï¼ˆæ— ç¼“å­˜ï¼‰ | æ…¢ï¼ˆ20-30sï¼‰   | å¿«ï¼ˆ8-12sï¼‰        | **æå¿«**ï¼ˆ3-9sï¼‰             |
| **ç¼“å­˜å®‰è£…é€Ÿåº¦**       | 1-2s           | 4-5s               | **<1s**                      |
| **ç£ç›˜å ç”¨**           | 100%ï¼ˆåŸºå‡†ï¼‰   | 90-100%            | **20-30%**                   |
| **Monorepo æ”¯æŒ**      | åŸºç¡€ï¼ˆnpm 7+ï¼‰ | æˆç†Ÿï¼ˆWorkspacesï¼‰ | **æœ€ä¼˜**ï¼ˆç¡¬é“¾æ¥è·¨é¡¹ç›®å…±äº«ï¼‰ |

> **å®æµ‹åœºæ™¯**ï¼ˆ1000 ä¸ªä¾èµ–é¡¹ç›®ï¼‰ï¼š
>
> - `npm install`: 28.5s | 450 MB
> - `yarn install`: 12.8s | 420 MB
> - `pnpm install`: 6.3s | 180 MB

### ğŸ› ï¸ **åŠŸèƒ½ä¸ç”Ÿæ€å¯¹æ¯”**

| **èƒ½åŠ›**                    | npm                      | Yarn                 | pnpm                  |
| :-------------------------- | :----------------------- | :------------------- | :-------------------- |
| **Monorepo å‘½ä»¤**           | éœ€ç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆå¦‚ Lernaï¼‰ | `yarn workspaces`    | `pnpm -r`ï¼ˆé€’å½’æ‰§è¡Œï¼‰ |
| **å®‰å…¨å®¡è®¡**                | `npm audit`              | `yarn audit`         | `pnpm audit`          |
| **å³æ’å³ç”¨ï¼ˆPnPï¼‰**         | âŒ                        | âœ…ï¼ˆYarn Berry é»˜è®¤ï¼‰ | âŒ                     |
| **é›¶å®‰è£…ï¼ˆZero-Installsï¼‰** | âŒ                        | âœ…ï¼ˆYarn Berryï¼‰      | âŒ                     |
| **ä¾èµ–è¡¥ä¸**                | âŒ                        | `yarn patch`         | `pnpm patch`          |

### ç»„ä»¶è°ƒè¯•

#### æ–¹æ³•1ï¼šä½¿ç”¨ `pnpm link`

- ä½¿ç”¨æ–¹å¼

  - åœ¨åŒ…ç›®å½•ä¸­åˆ›å»ºå…¨å±€é“¾æ¥

    ```bash
    cd D:\Data\CODE\npmjs\rslib-fetch
    pnpm link --global
    ```

  - åœ¨é¡¹ç›®ç›®å½•ä¸­é“¾æ¥æœ¬åœ°åŒ…

    ```bash
    cd D:\Data\CODE\my-project
    pnpm link --global rslib-fetch
    ```

  - éªŒè¯é“¾æ¥

    ```bash
    # åœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œ
    pnpm list rslib-fetch
    # åº”è¯¥æ˜¾ç¤ºç±»ä¼¼ï¼š
    # rslib-fetch link:D:\Data\CODE\npmjs\rslib-fetch
    ```

- ä¼˜ç‚¹

  - å®æ—¶æ›´æ–°ï¼šåŒ…ä¸­çš„æ›´æ”¹ä¼šç«‹å³åæ˜ åœ¨é¡¹ç›®ä¸­
  - æ— éœ€é‡æ–°å®‰è£…
  - æ”¯æŒçƒ­é‡è½½

#### æ–¹æ³•2ï¼šä½¿ç”¨æ–‡ä»¶è·¯å¾„å®‰è£…

- ä½¿ç”¨æ–¹å¼

  ```bash
  cd D:\Data\CODE\my-project
  pnpm install D:\Data\CODE\npmjs\rslib-fetch
  ```

- ä¼˜ç‚¹
  - æ›´æ¥è¿‘çœŸå®å®‰è£…ç¯å¢ƒ
  - ä¸ä¼šæ±¡æŸ“å…¨å±€å‘½åç©ºé—´

### changelog.mdç”Ÿæˆ

- standard-version

  é…ç½®package.json

  ```json
  "scripts": {
    "release": "standard-version"
  }
  ```

  ```bash
  npm run release
  ```

- conventional-changelog

  ```json
  "scripts": {
    "changelog": "conventional-changelog -p angular -i CHANGELOG.md -s -r 0"
  }
  ```

  | å‚æ•°              | è¯´æ˜                                                         |
  | :---------------- | :----------------------------------------------------------- |
  | `-p angular`      | ä½¿ç”¨ **Angular é¢„è®¾è§„èŒƒ**ï¼ˆåŸºäº [Conventional Commits](https://www.conventionalcommits.org/)ï¼‰ï¼Œè‡ªåŠ¨æŒ‰ `feat`, `fix`, `break` ç­‰ç±»å‹åˆ†ç±»æäº¤è®°å½•ã€‚ |
  | `-i CHANGELOG.md` | å°†ç”Ÿæˆçš„æ—¥å¿—å†™å…¥ `CHANGELOG.md` æ–‡ä»¶ï¼ˆè¾“å…¥æ–‡ä»¶è·¯å¾„ï¼‰ã€‚       |
  | `-s`              | é™é»˜æ¨¡å¼ï¼ˆä¸è¾“å‡ºè¿‡ç¨‹ä¿¡æ¯ï¼‰ã€‚                                 |
  | `-r 0`            | ç”Ÿæˆ **æœªå‘å¸ƒç‰ˆæœ¬ï¼ˆUnreleasedï¼‰** çš„å˜æ›´æ—¥å¿—ï¼ˆé€‚ç”¨äºå°šæœªæ‰“ Git Tag çš„æ–°æäº¤ï¼‰ã€‚ |

  æ‰§è¡Œæ•ˆæœï¼š

  1. **è¯»å– Git æäº¤å†å²**ï¼šæ‰«æé¡¹ç›®çš„ Git æäº¤è®°å½•ï¼ˆéœ€ç¬¦åˆ Angular è§„èŒƒï¼‰ã€‚
  2. **ç”Ÿæˆæ—¥å¿—**ï¼šå°†æäº¤æŒ‰ç±»å‹åˆ†ç»„ï¼ˆå¦‚ `Features`, `Bug Fixes`, `Breaking Changes`ï¼‰ã€‚
  3. **æ›´æ–°æ–‡ä»¶**ï¼šå°†ç”Ÿæˆçš„æ—¥å¿—**æ’å…¥åˆ° `CHANGELOG.md` æ–‡ä»¶é¡¶éƒ¨**ï¼ˆä¿ç•™åŸæœ‰å†…å®¹ï¼‰ã€‚
  4. **æœªå‘å¸ƒç‰ˆæœ¬**ï¼š`-r 0` ä¼šç”Ÿæˆç±»ä¼¼ä»¥ä¸‹æ ‡é¢˜çš„æ—¥å¿—ï¼š

### å•å…ƒæµ‹è¯•

- vitest
- @vitest/coverage-v8

## npm

### package.json

### ğŸ“¦ **ä¸€ã€åŸºç¡€æ ‡è¯†å±æ€§**

| å±æ€§              | ç±»å‹     | å¿…å¡« | è¯´æ˜                       | ç¤ºä¾‹                                 |
| :---------------- | :------- | :--- | :------------------------- | :----------------------------------- |
| **`name`**        | string   | âœ…    | åŒ…åï¼ˆnpm å”¯ä¸€æ ‡è¯†ï¼‰       | `"name": "my-package"`               |
| **`version`**     | string   | âœ…    | è¯­ä¹‰åŒ–ç‰ˆæœ¬å·               | `"version": "1.0.0"`                 |
| **`description`** | string   |      | åŒ…æè¿°ï¼ˆnpm æœç´¢å±•ç¤ºï¼‰     | `"description": "A utility library"` |
| **`keywords`**    | string[] |      | å…³é”®è¯æ•°ç»„ï¼ˆæå‡æœç´¢æ’åï¼‰ | `"keywords": ["react", "utils"]`     |
| **`license`**     | string   |      | å¼€æºåè®®                   | `"license": "MIT"`                   |

### ğŸ”— **äºŒã€ä¾èµ–ç®¡ç†**

| å±æ€§                       | ç±»å‹     | ä½œç”¨                                   | ç¤ºä¾‹                                               |
| :------------------------- | :------- | :------------------------------------- | :------------------------------------------------- |
| **`dependencies`**         | Object   | **ç”Ÿäº§ç¯å¢ƒä¾èµ–**ï¼ˆç”¨æˆ·å®‰è£…æ—¶è‡ªåŠ¨ä¸‹è½½ï¼‰ | `"dependencies": { "lodash": "^4.17.21" }`         |
| **`devDependencies`**      | Object   | **å¼€å‘ç¯å¢ƒä¾èµ–**ï¼ˆä¸æ‰“åŒ…åˆ°ç”Ÿäº§ï¼‰       | `"devDependencies": { "eslint": "^8.0.0" }`        |
| **`peerDependencies`**     | Object   | **åŒä¼´ä¾èµ–**ï¼ˆå®¿ä¸»ç¯å¢ƒéœ€å®‰è£…çš„åŒ…ï¼‰     | `"peerDependencies": { "react": ">=16.8" }`        |
| **`optionalDependencies`** | Object   | å¯é€‰ä¾èµ–ï¼ˆå®‰è£…å¤±è´¥ä¸ä¸­æ–­æµç¨‹ï¼‰         | `"optionalDependencies": { "fsevents": "^2.3.2" }` |
| **`bundledDependencies`**  | string[] | æ‰“åŒ…è¿›å‘å¸ƒåŒ…çš„ä¾èµ–ï¼ˆè„±ç¦» npm åˆ†å‘ï¼‰    | `"bundledDependencies": ["local-dep"]`             |
| **`overrides`**            | Object   | **å¼ºåˆ¶æŒ‡å®šä¾èµ–ç‰ˆæœ¬**ï¼ˆè¦†ç›–åµŒå¥—ä¾èµ–ï¼‰   | `"overrides": { "axios": "1.2.1" }`                |

### ğŸš€ **ä¸‰ã€å…¥å£ä¸æ–‡ä»¶é…ç½®**

| å±æ€§          | ç±»å‹     | ä½œç”¨                                | ç¤ºä¾‹                                  |
| :------------ | :------- | :---------------------------------- | :------------------------------------ |
| **`main`**    | string   | **CommonJS å…¥å£æ–‡ä»¶**               | `"main": "./dist/index.js"`           |
| **`module`**  | string   | ES Module å…¥å£ï¼ˆæ”¯æŒ Tree Shakingï¼‰ | `"module": "./dist/index.mjs"`        |
| **`browser`** | string   | æµè§ˆå™¨ä¸“å±å…¥å£                      | `"browser": "./browser.js"`           |
| **`types`**   | string   | TypeScript ç±»å‹å£°æ˜æ–‡ä»¶             | `"types": "./dist/index.d.ts"`        |
| **`exports`** | Object   | **æ¡ä»¶åŒ–å¯¼å‡º**ï¼ˆNode.js 12+ï¼‰       | [è§ä¸‹æ–¹è¯¦è§£]                          |
| **`files`**   | string[] | **å‘å¸ƒåˆ° npm çš„æ–‡ä»¶ç™½åå•**         | `"files": ["dist", "types"]`          |
| **`bin`**     | Object   | **å¯æ‰§è¡Œå‘½ä»¤æ˜ å°„**ï¼ˆCLI å·¥å…·ï¼‰      | `"bin": { "my-cli": "./bin/cli.js" }` |

#### `exports` é«˜çº§ç”¨æ³•ï¼š

```js
"exports": {
  ".": {
    "import": "./dist/index.mjs",   // ES Module
    "require": "./dist/index.cjs",  // CommonJS
    "types": "./dist/index.d.ts"    // TypeScript
  },
  "./feature": "./src/feature.js"   // å­è·¯å¾„å¯¼å‡º
}
```

### âš™ï¸ **å››ã€è„šæœ¬æ§åˆ¶**

| å±æ€§                               | ç±»å‹   | ä½œç”¨                | ç¤ºä¾‹                             |
| :--------------------------------- | :----- | :------------------ | :------------------------------- |
| **`scripts`**                      | Object | **è‡ªå®šä¹‰ npm è„šæœ¬** | `"scripts": { "build": "tsc" }`  |
| **`config`**                       | Object | è„šæœ¬ç¯å¢ƒå˜é‡æ³¨å…¥    | `"config": { "port": 8080 }`     |
| **`preinstall`** **`postinstall`** | string | **ç”Ÿå‘½å‘¨æœŸé’©å­**    | `"postinstall": "node setup.js"` |

#### å®Œæ•´ç”Ÿå‘½å‘¨æœŸé’©å­ï¼š

```bash
prepublish â†’ prepare â†’ prepublishOnly â†’ prepack â†’ postpack â†’ publish â†’ postpublish
preinstall â†’ install â†’ postinstall
preuninstall â†’ uninstall â†’ postuninstall
pretest â†’ test â†’ posttest
```

### ğŸŒ **äº”ã€å‘å¸ƒé…ç½®**

| å±æ€§                | ç±»å‹     | ä½œç”¨               | ç¤ºä¾‹                                                         |
| :------------------ | :------- | :----------------- | :----------------------------------------------------------- |
| **`private`**       | boolean  | **ç¦æ­¢å‘å¸ƒåˆ° npm** | `"private": true`                                            |
| **`publishConfig`** | Object   | å‘å¸ƒæ—¶è¦†ç›–é…ç½®     | `"publishConfig": { "registry": "https://private.npm.org" }` |
| **`os`**            | string[] | é™å®šæ“ä½œç³»ç»Ÿ       | `"os": ["darwin", "linux"]`                                  |
| **`cpu`**           | string[] | é™å®š CPU æ¶æ„      | `"cpu": ["x64", "arm64"]`                                    |
| **`engines`**       | Object   | **è¿è¡Œæ—¶ç¯å¢ƒè¦æ±‚** | `"engines": { "node": ">=18.0.0" }`                          |

### ğŸ“š **å…­ã€æ–‡æ¡£ä¸ä»“åº“**

| å±æ€§               | ç±»å‹     | ä½œç”¨             | ç¤ºä¾‹                                                         |
| :----------------- | :------- | :--------------- | :----------------------------------------------------------- |
| **`author`**       | Object   | ä½œè€…ä¿¡æ¯         | `"author": { "name": "Alice", "email": "alice@example.com" }` |
| **`contributors`** | Object[] | è´¡çŒ®è€…åˆ—è¡¨       | `"contributors": [{ "name": "Bob" }]`                        |
| **`homepage`**     | string   | é¡¹ç›®ä¸»é¡µ         | `"homepage": "https://example.com"`                          |
| **`repository`**   | Object   | **ä»£ç ä»“åº“åœ°å€** | `"repository": { "type": "git", "url": "https://github.com/user/repo.git" }` |
| **`bugs`**         | Object   | é—®é¢˜åé¦ˆåœ°å€     | `"bugs": { "url": "https://github.com/user/repo/issues" }`   |
| **`funding`**      | Object   | èµåŠ©ä¿¡æ¯         | `"funding": { "type": "patreon", "url": "https://patreon.com/user" }` |

### âš¡ **ä¸ƒã€ç°ä»£ä¼˜åŒ–å±æ€§**

| å±æ€§               | ç±»å‹     | ä½œç”¨                               | ç¤ºä¾‹                                        |
| :----------------- | :------- | :--------------------------------- | :------------------------------------------ |
| **`type`**         | string   | **æ¨¡å—ç±»å‹** (`commonjs`/`module`) | `"type": "module"`                          |
| **`sideEffects`**  | boolean  | **Tree Shaking æ ‡è®°**              | `"sideEffects": false`                      |
| **`workspaces`**   | string[] | **Monorepo å·¥ä½œåŒºé…ç½®**            | `"workspaces": ["packages/*"]`              |
| **`eslintConfig`** | Object   | å†…è” ESLint é…ç½®                   | `"eslintConfig": { "extends": "standard" }` |
| **`browserslist`** | string[] | ç›®æ ‡æµè§ˆå™¨èŒƒå›´                     | `"browserslist": ["defaults"]`              |



