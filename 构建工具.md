## 构建工具

### webpack

- ##### 打包构建

  - 在产物中，webpack通常会将多个模块打包成一个或多个bundle文件
  - 这些bundle文件的格式是多种形式的，如CommonJS（在node环境下常用）或者IIFE（立即调用函数表达式，用于浏览器环境）
  - 对于浏览器环境，webpack会将所有的JavaScript模块打包成一个或几个打的文件，并且通过自定义的加载逻辑来加载模块
  - 例如，在一个简单的webpack打包后的JavaScript文件中，可能会看到类似__webpack_require\_\_这样的函数来实现模块的加载和解析

  - 这种打包方式会吧所有的模块依赖关系都内建在bundle文件中，使得浏览器在加载时只需加载一个或几个文件即可，当应用规模过大可能会导致首次加载时间过长
  - 可以使用code splitting，分割代码chunk，动态加载

### vite

#### 开发阶段和构建有何不同

- ##### 开发阶段

  - 快速的模块加载
    - 利用浏览器对原生ES模块（ESM）的支持
    - 当浏览器请求一个模块时，Vite直接将对应的ES模块文件发送给浏览器，而不需要先进行打包；使得模块加载速度非常快，浏览器可以直接解析和执行这些原生模块
  - 高效的模块热替换（HMR）
    - Vite的HMR功能允许修改代码后，只更新发生变化的模块，而不需要刷新整个页面
    - 通过建立一个WebSocket连接来实时监听文件变化
    - 当一个模块修改后，Vite会将更新后的模块发送给浏览器，浏览器会用新模块替换旧模块，同时报错应用的当前状态
  - 开发服务器的便利性
    - Vite提供一个轻量级的开发服务器，可以快速启动并且自动处理一些常见的开发任务，如解析import语句、CSS的@import等
    - 开发服务器还支持一个开发时的功能，如自动打开浏览器、代理请求等

- ##### 构建阶段

  - 代码打包与优化
    - Vite使用Rollup作为打包工具（在vite build过程中）
    - Rollup会对项目中所有的ES模块进行静态分析，将它们打包成一个活多个适合生产环境的文件
    - 这个过程包括Tree-Shaking，以及作用域提升来优化代码结构，减少变量查找的层级，从而生成更紧凑高效的代码
  - 资源处理与整合
    - Vite在构建阶段会对各种资源（如CSS、静态图片、字体等）进行处理
  - 输出格式和部署准备
    - 会根据配置生成适合生产环境部署的文件格式
    - 生成多张格式输入，如umd、es、cjs等

### webpack 与  Vite的差异

#### 构建原理差异

- webpack
  - 基于打包（Bundle）的理念
  - 在处理模块时，webpack会从一个入口文件开始，递归的构建整个模块依赖图
  - 会把所有的模块（包括JavaScript、CSS、图片等资源）都打包到一个或多个bundle文件中
- Vite
  - 基于原生ES模块（ESM）的开发服务器
  - 对于生产环境，Vite会进行预构建（Pre-build），主要是为了将一些非ESM格式的依赖（如CommonJS模块）转换为ESM格式，以确保在浏览器环境中能够高效的加载和运行
  - 预构建的过程中相对简单快速，只对需要转换的依赖进行处理，不会像webpack那样对整个项目进行全面打包

#### 开发体验差异

- 启动速度
  - webpack
    - 启动速度较慢，首屏加载快，需要在启动时构建整个模块依赖图并进行打包操作
  - Vite
    - 启动速度极快，首屏加载慢，不需要进行完整的打包过程
- 模块热替换（HMR）体验
  - webpack
    - webpack的HMR配置较为复杂，需要针对不同类型的模块（如样式模块、JavaScript模块等）进行专门的配置
    - 在复杂的场景下，webpack的HMR可能出现更新不及时或不完全的情况
  - Vite
    - Vite 的 HMR 配置相对简单，基于原生 ES 模块，在更新模块时，浏览器可以更快地获取和更新新的模块代码

### rsbuild
