## ä¸€ã€Vuex åŸç†æ¦‚è¿°

Vuex æ˜¯ **ä¸“ä¸º Vue.js åº”ç”¨ç¨‹åºå¼€å‘çš„çŠ¶æ€ç®¡ç†æ¨¡å¼**ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ **é›†ä¸­ç®¡ç†ç»„ä»¶å…±äº«çš„çŠ¶æ€**ï¼Œå¹¶ä¿è¯çŠ¶æ€ä»¥ä¸€ç§å¯é¢„æµ‹çš„æ–¹å¼å‘ç”Ÿå˜åŒ–ã€‚

### 1. æ ¸å¿ƒæ¦‚å¿µ

- **Stateï¼ˆçŠ¶æ€ï¼‰**ï¼šå­˜æ”¾åº”ç”¨çš„å…±äº«æ•°æ®ã€‚
- **Getterï¼ˆè®¡ç®—å±æ€§ï¼‰**ï¼šå¯¹ State çš„è¡ç”Ÿæ•°æ®è¿›è¡Œå°è£…ã€‚
- **Mutationï¼ˆå˜æ›´ï¼‰**ï¼šå”¯ä¸€å…è®¸ä¿®æ”¹ state çš„æ–¹æ³•ï¼Œä¸”å¿…é¡»æ˜¯åŒæ­¥æ“ä½œã€‚
- **Actionï¼ˆåŠ¨ä½œï¼‰**ï¼šå¯ä»¥åŒ…å«å¼‚æ­¥æ“ä½œï¼Œç„¶åé€šè¿‡ `commit` è°ƒç”¨ mutationã€‚
- **Moduleï¼ˆæ¨¡å—ï¼‰**ï¼šç”¨äºæ‹†åˆ†å¤§å‹ storeï¼Œæ”¯æŒæ¨¡å—åŒ–ç®¡ç† stateã€mutationã€actionã€getterã€‚

------

### 2. Vuex çš„åŸç†æœºåˆ¶

#### (1) åˆ©ç”¨ Vue çš„å“åº”å¼ç³»ç»Ÿ

Vuex çš„ `state` é€šè¿‡ `Vue.observable()`ï¼ˆVue 2ï¼‰æˆ–è€… Vue 3 çš„ `reactive()` å˜ä¸ºå“åº”å¼å¯¹è±¡ã€‚

- **æ•ˆæœ**ï¼šå½“ state å˜åŒ–æ—¶ï¼Œä¾èµ– state çš„ç»„ä»¶ä¼šè‡ªåŠ¨æ›´æ–°ã€‚

ç¤ºä¾‹ï¼š

```js
import Vue from 'vue'
const state = Vue.observable({ count: 0 })
const mutations = {
  increment() {
    state.count++
  }
}
export default { state, mutations }
```

è¿™é‡Œçš„ `state.count` å˜åŒ–ä¼šè§¦å‘è§†å›¾æ›´æ–°ã€‚

------

#### (2) Mutation ä¸ Action çš„å·¥ä½œæµç¨‹

1. **Mutation**
   - åªèƒ½åŒæ­¥æ“ä½œ
   - Vuex é€šè¿‡ `commit('mutationName', payload)` è§¦å‘ mutation
   - mutation å†…éƒ¨ç›´æ¥ä¿®æ”¹ stateï¼Œä¿è¯çŠ¶æ€å˜æ›´å¯è¿½è¸ª
2. **Action**
   - å¯ä»¥å¼‚æ­¥æ“ä½œ
   - å†…éƒ¨é€šè¿‡ `context.commit` è°ƒç”¨ mutation ä¿®æ”¹ state

> æ ¸å¿ƒæ€è·¯ï¼š**mutation ç”¨æ¥ä¿®æ”¹ stateï¼Œaction ç”¨æ¥å°è£…å¼‚æ­¥é€»è¾‘**ã€‚

------

#### (3) Store çš„å®ç°æ ¸å¿ƒ

Vuex çš„ Store å¤§ä½“ç»“æ„å¦‚ä¸‹ï¼š

```js
class Store {
  constructor(options) {
    // å“åº”å¼ state
    this._state = Vue.observable(options.state || {})
    this._mutations = options.mutations || {}
    this._actions = options.actions || {}
    this._getters = options.getters || {}
    
    // ç»‘å®š commit å’Œ dispatch
    this.commit = this.commit.bind(this)
    this.dispatch = this.dispatch.bind(this)
  }

  commit(type, payload) {
    const mutation = this._mutations[type]
    if (mutation) mutation(this._state, payload)
  }

  dispatch(type, payload) {
    const action = this._actions[type]
    if (action) return action({ state: this._state, commit: this.commit }, payload)
  }

  get state() {
    return this._state
  }
}
```

#### (4) Getter çš„å®ç°

Getter ç±»ä¼¼ Vue çš„è®¡ç®—å±æ€§ï¼š

- å¯¹ state åšåŠ å·¥å¤„ç†
- å…·æœ‰ç¼“å­˜åŠŸèƒ½ï¼ˆä¾èµ– stateï¼Œstate ä¸å˜æ—¶ä¸é‡æ–°è®¡ç®—ï¼‰

------

#### (5) æ¨¡å—åŒ–

Vuex æ”¯æŒæ¨¡å— Moduleï¼Œæ¯ä¸ªæ¨¡å—æœ‰ç‹¬ç«‹çš„ stateã€mutationã€actionã€getterï¼Œé€šè¿‡ `namespaced: true` å¯ä»¥å®ç°å‘½åç©ºé—´ã€‚

- **ä½œç”¨**ï¼šå¤§è§„æ¨¡é¡¹ç›®é¿å…å‘½åå†²çªï¼Œæ–¹ä¾¿ç®¡ç†ã€‚

------

### 3. Vuex å“åº”å¼æ›´æ–°åŸç†

1. Store çš„ state æ˜¯å“åº”å¼å¯¹è±¡
2. Vue ç»„ä»¶é€šè¿‡ `mapState`ã€`mapGetters` ç­‰è®¿é—® state
3. å½“ mutation ä¿®æ”¹ state æ—¶ï¼ŒVue å“åº”å¼ç³»ç»Ÿæ£€æµ‹åˆ°å˜åŒ–ï¼Œè‡ªåŠ¨è§¦å‘è§†å›¾æ›´æ–°

------

## äºŒã€Vuex ç›¸å…³é¢è¯•é¢˜

### é¢è¯•é¢˜ 1ï¼šVuex çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

**ç­”æ¡ˆè¦ç‚¹**ï¼š

- é›†ä¸­ç®¡ç†ç»„ä»¶å…±äº«çŠ¶æ€
- çŠ¶æ€å˜æ›´å¯è¿½è¸ªã€å¯é¢„æµ‹
- æé«˜å¤§å‹åº”ç”¨çš„å¯ç»´æŠ¤æ€§

------

### é¢è¯•é¢˜ 2ï¼šVuex çš„ stateã€getterã€mutationã€action æœ‰ä½•åŒºåˆ«ï¼Ÿ

| å±æ€§     | ç”¨é€”                | ç‰¹ç‚¹                          |
| -------- | ------------------- | ----------------------------- |
| state    | å­˜å‚¨å…±äº«çŠ¶æ€        | å“åº”å¼                        |
| getter   | å¯¹ state çš„è¡ç”Ÿè®¡ç®— | ç±»ä¼¼è®¡ç®—å±æ€§                  |
| mutation | ä¿®æ”¹ state          | åŒæ­¥æ“ä½œï¼Œè®°å½•æ—¥å¿—å¯è¿½è¸ª      |
| action   | å¼‚æ­¥æ“ä½œæˆ–å¤æ‚é€»è¾‘  | å†…éƒ¨é€šè¿‡ commit è°ƒç”¨ mutation |

------

### é¢è¯•é¢˜ 3ï¼šä¸ºä»€ä¹ˆ mutation å¿…é¡»åŒæ­¥ï¼Ÿ

- Vuex ä¾èµ– devtools è¿½è¸ªçŠ¶æ€å˜æ›´
- å¼‚æ­¥æ“ä½œä¼šæ‰“ä¹±è®°å½•é¡ºåºï¼Œå¯¼è‡´è°ƒè¯•å›°éš¾
- å¼‚æ­¥æ“ä½œåº”æ”¾åœ¨ action ä¸­

------

### é¢è¯•é¢˜ 4ï¼šVuex çš„å“åº”å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ

- Vuex state æ˜¯ Vue çš„å“åº”å¼å¯¹è±¡ï¼ˆ`Vue.observable()` / `reactive()`ï¼‰
- ç»„ä»¶ä¾èµ– stateï¼Œstate æ”¹å˜è§¦å‘ç»„ä»¶æ›´æ–°

------

### é¢è¯•é¢˜ 5ï¼šVuex ä¸­ actionã€mutationã€getter çš„è°ƒç”¨æ–¹å¼ï¼Ÿ

```
store.commit('mutationName', payload) // ä¿®æ”¹ state
store.dispatch('actionName', payload) // è°ƒç”¨ action
store.getters['getterName']            // è·å– getter
```

------

### é¢è¯•é¢˜ 6ï¼šVuex æ¨¡å—åŒ–æœ‰ä»€ä¹ˆç”¨ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ

- **ä½œç”¨**ï¼šåˆ†æ¨¡å—ç®¡ç† stateï¼Œæé«˜å¯ç»´æŠ¤æ€§
- **å®ç°**ï¼šåœ¨ store ä¸­é…ç½® modulesï¼Œå¹¶å¯ä½¿ç”¨ `namespaced: true`

```js
const moduleA = {
  namespaced: true,
  state: { count: 0 },
  mutations: { increment(state) { state.count++ } },
}

const store = new Vuex.Store({
  modules: { a: moduleA }
})
```

## ä¸€ã€å¸¸ç”¨ Vuex è¾…åŠ©å‡½æ•°

### 1. `mapState`

- **ä½œç”¨**ï¼šæŠŠ store çš„ state æ˜ å°„åˆ°ç»„ä»¶çš„è®¡ç®—å±æ€§ã€‚
- **ç”¨æ³•**ï¼š

```js
import { mapState } from 'vuex'

export default {
  computed: {
    ...mapState(['count']), // ç›´æ¥æ˜ å°„ state.count
    ...mapState({
      doubleCount: state => state.count * 2 // è‡ªå®šä¹‰æ˜ å°„
    })
  }
}
```

- **æ•ˆæœ**ï¼šç»„ä»¶ä¸­å¯ä»¥ç›´æ¥ç”¨ `this.count` æˆ– `this.doubleCount`ï¼Œä¸å¿…å†™ `this.$store.state.count`ã€‚

------

### 2. `mapGetters`

- **ä½œç”¨**ï¼šæŠŠ store çš„ getter æ˜ å°„åˆ°ç»„ä»¶çš„è®¡ç®—å±æ€§ã€‚
- **ç”¨æ³•**ï¼š

```js
import { mapGetters } from 'vuex'

export default {
  computed: {
    ...mapGetters(['doneTodosCount']), // æ˜ å°„ getter
    ...mapGetters({
      doneCount: 'doneTodosCount' // è‡ªå®šä¹‰å‘½å
    })
  }
}
```

- **æ•ˆæœ**ï¼šç»„ä»¶å¯ä»¥ç›´æ¥ç”¨ `this.doneCount`ï¼Œç­‰ä»·äº `this.$store.getters.doneTodosCount`ã€‚

------

### 3. `mapMutations`

- **ä½œç”¨**ï¼šæŠŠ store çš„ mutation æ˜ å°„åˆ°ç»„ä»¶çš„æ–¹æ³•ä¸­ã€‚
- **ç”¨æ³•**ï¼š

```js
import { mapMutations } from 'vuex'

export default {
  methods: {
    ...mapMutations(['increment']), // æ˜ å°„ mutation
    ...mapMutations({
      add: 'increment' // è‡ªå®šä¹‰æ–¹æ³•å
    })
  }
}
```

- **è°ƒç”¨æ–¹å¼**ï¼š`this.increment(payload)` æˆ– `this.add(payload)`ï¼Œå†…éƒ¨ä¼š `commit` mutationã€‚

------

### 4. `mapActions`

- **ä½œç”¨**ï¼šæŠŠ store çš„ action æ˜ å°„åˆ°ç»„ä»¶çš„æ–¹æ³•ä¸­ã€‚
- **ç”¨æ³•**ï¼š

```js
import { mapActions } from 'vuex'

export default {
  methods: {
    ...mapActions(['fetchData']),
    ...mapActions({
      getData: 'fetchData' // è‡ªå®šä¹‰æ–¹æ³•å
    })
  }
}
```

- **è°ƒç”¨æ–¹å¼**ï¼š`this.fetchData(payload)`ï¼Œå†…éƒ¨ä¼š `dispatch` actionã€‚

------

### 5. `mapModules` / `createNamespacedHelpers`ï¼ˆæ¨¡å—è¾…åŠ©ï¼‰

- **ä½œç”¨**ï¼šåœ¨å‘½åç©ºé—´æ¨¡å—ä¸­ä½¿ç”¨ map è¾…åŠ©å‡½æ•°ã€‚
- **ç”¨æ³•**ï¼š

```js
import { createNamespacedHelpers } from 'vuex'

const { mapState, mapGetters, mapActions, mapMutations } = createNamespacedHelpers('moduleA')

export default {
  computed: {
    ...mapState(['count']),
    ...mapGetters(['doneCount'])
  },
  methods: {
    ...mapActions(['fetchData']),
    ...mapMutations(['increment'])
  }
}
```

- **æ•ˆæœ**ï¼šé¿å…åœ¨æ¨¡å—å‘½åç©ºé—´ä¸­é‡å¤å†™ `'moduleA/xxx'`ã€‚

------

### äºŒã€æ€»ç»“å¯¹æ¯”

| è¾…åŠ©å‡½æ•°                | æ˜ å°„å¯¹è±¡ | ç±»å‹         | è°ƒç”¨æ–¹å¼          |
| ----------------------- | -------- | ------------ | ----------------- |
| mapState                | state    | è®¡ç®—å±æ€§     | this.xxx          |
| mapGetters              | getter   | è®¡ç®—å±æ€§     | this.xxx          |
| mapMutations            | mutation | æ–¹æ³•         | this.xxx(payload) |
| mapActions              | action   | æ–¹æ³•         | this.xxx(payload) |
| createNamespacedHelpers | æ¨¡å—ä¸“ç”¨ | æ‰€æœ‰ä¸Šè¿°ç±»å‹ | è‡ªåŠ¨å¸¦å‘½åç©ºé—´    |

------

ğŸ’¡ **æ³¨æ„ç‚¹**ï¼š

- `mapState` å’Œ `mapGetters` æ˜ å°„åˆ° **è®¡ç®—å±æ€§**ï¼Œä¸èƒ½å†™å‰¯ä½œç”¨é€»è¾‘ã€‚
- `mapMutations` å’Œ `mapActions` æ˜ å°„åˆ° **methods**ï¼Œå¯æ¥æ”¶å‚æ•°å¹¶è§¦å‘ commit/dispatchã€‚
- æ¨¡å—åŒ–æ—¶å¼ºçƒˆå»ºè®®ä½¿ç”¨ `createNamespacedHelpers` é¿å…æ‰‹åŠ¨æ‹¼æ¥æ¨¡å—åã€‚