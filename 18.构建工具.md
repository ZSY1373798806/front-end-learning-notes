## 构建工具对比：Webpack vs Vite

### 1. **Webpack**

#### 打包与构建机制

- **模块打包**：
  - 将多个模块打包成一个或多个 bundle 文件。
  - 浏览器环境通常使用 IIFE（立即执行函数），Node 环境使用 CommonJS。
  - 打包后的文件内部通过类似 `__webpack_require__` 的函数来实现模块加载和依赖解析。
- **优点**：
  - 所有依赖内建在 bundle 中，浏览器只需加载少量文件。
- **缺点**：
  - 对大型项目，首次加载慢。
  - 依赖更新时，需要整体 rebuild。
- **优化方式**：
  - **Code Splitting**：按需分割 chunk，实现动态加载。
  - **Tree Shaking**：去除未使用代码。
  - **缓存优化**：长缓存与哈希命名。

------

### 2. **Vite**

#### 开发阶段

- **快速模块加载**：
  - 利用浏览器原生 ES 模块（ESM）支持。
  - 无需预打包，浏览器直接解析和执行模块。
- **高效 HMR**：
  - 文件修改后，只更新改变的模块，不刷新整个页面。
  - 通过 WebSocket 监听文件变化。
- **开发服务器便利性**：
  - 内置轻量开发服务器。
  - 支持自动解析 import、CSS @import 等。
  - 提供自动打开浏览器、代理请求等功能。

#### 构建阶段

- **使用 Rollup 打包**：
  - 对所有 ES 模块静态分析，生成优化后的生产文件。
  - 支持 Tree Shaking、作用域提升等优化。
- **资源处理与整合**：
  - CSS、图片、字体等资源打包。
- **输出格式与部署**：
  - 支持多种模块格式：ESM、UMD、CJS 等。
  - 生成适合生产环境的文件。

------

### 3. **Webpack vs Vite 的差异**

#### 构建原理

| 特性       | Webpack                              | Vite                                                     |
| ---------- | ------------------------------------ | -------------------------------------------------------- |
| 核心理念   | Bundle 打包                          | 原生 ES 模块开发 + Rollup 构建                           |
| 模块处理   | 从入口递归构建依赖图，将所有模块打包 | 开发阶段按需提供原生 ESM；生产阶段通过 Rollup 打包并优化 |
| 依赖预处理 | 无特定预构建机制                     | 对非 ESM 模块（如 CommonJS）进行预构建，保证浏览器兼容   |

#### 开发体验

| 特性     | Webpack                  | Vite                               |
| -------- | ------------------------ | ---------------------------------- |
| 启动速度 | 较慢，需要构建整个依赖图 | 极快，无需完整打包，首屏慢依赖加载 |
| HMR 体验 | 配置复杂，更新可能不及时 | 简单高效，基于 ESM，更新快、实时   |

### **Webpack / Vite / rsbuild 对比**

| 特性       | Webpack                          | Vite                      | rsbuild                            |
| ---------- | -------------------------------- | ------------------------- | ---------------------------------- |
| 核心理念   | Bundle 打包                      | ESM + Rollup 构建         | ESM 快速构建                       |
| 启动速度   | 较慢                             | 极快                      | 极快                               |
| HMR        | 配置复杂，更新可能不全           | 简单高效，实时更新        | 简单高效，实时更新                 |
| 构建工具   | Webpack 核心                     | Rollup                    | 内置高效构建                       |
| 生产优化   | Tree Shaking、代码分割、缓存优化 | Tree Shaking、作用域提升  | Tree Shaking、代码压缩，多格式输出 |
| 配置复杂度 | 高，插件/loader 体系庞大         | 中，基于默认配置 + 可扩展 | 低，开箱即用                       |
| 生态       | 极其丰富                         | 生态增长快                | 较小，但可满足常规需求             |
| 适用场景   | 大型复杂项目，需要精细控制       | 中小型项目，快速开发      | 中大型项目，追求构建和启动速度     |
